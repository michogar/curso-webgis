



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Curso WebGIS. Mapas libres con Leaflet y OpenLayers</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../../../#forge" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Curso WebGIS. Mapas libres con Leaflet y OpenLayers
              </span>
              <span class="md-header-nav__topic">
                Forge
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Curso WebGIS. Mapas libres con Leaflet y OpenLayers
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../1_creando_mapa/" title="1. Creando un mapa" class="md-nav__link">
      1. Creando un mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../2_capas_base/" title="2. El mapa sin datos. Añadir una capa base" class="md-nav__link">
      2. El mapa sin datos. Añadir una capa base
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../3_mis_datos/" title="3. Mas allá de la capa base, añadiendo mis propios datos" class="md-nav__link">
      3. Mas allá de la capa base, añadiendo mis propios datos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../4_wms_wmts/" title="4. Y si los datos son enormes" class="md-nav__link">
      4. Y si los datos son enormes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../5_interactuando_mapa/" title="5. Interactuando con el mapa" class="md-nav__link">
      5. Interactuando con el mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../6_osm_y_tilemill/" title="6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres" class="md-nav__link">
      6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../7_extra_1_osm_y_umap/" title="7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap" class="md-nav__link">
      7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" title="Performance" class="md-nav__link">
    Performance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link">
    Documentation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" title="API" class="md-nav__link">
    API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transports" title="Transports" class="md-nav__link">
    Transports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ciphers" title="Ciphers" class="md-nav__link">
    Ciphers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pki" title="PKI" class="md-nav__link">
    PKI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-digests" title="Message Digests" class="md-nav__link">
    Message Digests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilities" title="Utilities" class="md-nav__link">
    Utilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other" title="Other" class="md-nav__link">
    Other
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodejs" title="Node.js" class="md-nav__link">
    Node.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bundle-bower" title="Bundle / Bower" class="md-nav__link">
    Bundle / Bower
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsdelivr-cdn" title="jsDelivr CDN" class="md-nav__link">
    jsDelivr CDN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unpkg-cdn" title="unpkg CDN" class="md-nav__link">
    unpkg CDN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-requirements" title="Development Requirements" class="md-nav__link">
    Development Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-for-a-web-browser" title="Building for a web browser" class="md-nav__link">
    Building for a web browser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-custom-browser-bundle" title="Building a custom browser bundle" class="md-nav__link">
    Building a custom browser bundle
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-to-run-tests" title="Prepare to run tests" class="md-nav__link">
    Prepare to run tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-automated-tests-with-nodejs" title="Running automated tests with Node.js" class="md-nav__link">
    Running automated tests with Node.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-automated-tests-with-phantomjs" title="Running automated tests with PhantomJS" class="md-nav__link">
    Running automated tests with PhantomJS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-automated-tests-with-one-or-more-browsers" title="Running automated tests with one or more browsers" class="md-nav__link">
    Running automated tests with one or more browsers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-manual-tests-in-a-browser" title="Running manual tests in a browser" class="md-nav__link">
    Running manual tests in a browser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-other-tests" title="Running other tests" class="md-nav__link">
    Running other tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coverage-testing" title="Coverage testing" class="md-nav__link">
    Coverage testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" title="Contributing" class="md-nav__link">
    Contributing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api_1" title="API" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" title="Options" class="md-nav__link">
    Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transports_1" title="Transports" class="md-nav__link">
    Transports
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tls" title="TLS" class="md-nav__link">
    TLS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http" title="HTTP" class="md-nav__link">
    HTTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh" title="SSH" class="md-nav__link">
    SSH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xhr" title="XHR" class="md-nav__link">
    XHR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sockets" title="Sockets" class="md-nav__link">
    Sockets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ciphers_1" title="Ciphers" class="md-nav__link">
    Ciphers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cipher" title="CIPHER" class="md-nav__link">
    CIPHER
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aes" title="AES" class="md-nav__link">
    AES
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#des" title="DES" class="md-nav__link">
    DES
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rc2" title="RC2" class="md-nav__link">
    RC2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pki_1" title="PKI" class="md-nav__link">
    PKI
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ed25519" title="ED25519" class="md-nav__link">
    ED25519
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsa" title="RSA" class="md-nav__link">
    RSA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsa-kem" title="RSA-KEM" class="md-nav__link">
    RSA-KEM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x509" title="X.509" class="md-nav__link">
    X.509
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkcs5" title="PKCS#5" class="md-nav__link">
    PKCS#5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkcs7" title="PKCS#7" class="md-nav__link">
    PKCS#7
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkcs8" title="PKCS#8" class="md-nav__link">
    PKCS#8
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkcs10" title="PKCS#10" class="md-nav__link">
    PKCS#10
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pkcs12" title="PKCS#12" class="md-nav__link">
    PKCS#12
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asn1" title="ASN.1" class="md-nav__link">
    ASN.1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-digests_1" title="Message Digests" class="md-nav__link">
    Message Digests
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sha1" title="SHA1" class="md-nav__link">
    SHA1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sha256" title="SHA256" class="md-nav__link">
    SHA256
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sha384" title="SHA384" class="md-nav__link">
    SHA384
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sha512" title="SHA512" class="md-nav__link">
    SHA512
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#md5" title="MD5" class="md-nav__link">
    MD5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hmac" title="HMAC" class="md-nav__link">
    HMAC
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities_1" title="Utilities" class="md-nav__link">
    Utilities
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prime" title="Prime" class="md-nav__link">
    Prime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prng" title="PRNG" class="md-nav__link">
    PRNG
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks" title="Tasks" class="md-nav__link">
    Tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utilities_2" title="Utilities" class="md-nav__link">
    Utilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" title="Logging" class="md-nav__link">
    Logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" title="Debugging" class="md-nav__link">
    Debugging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flash-networking-support" title="Flash Networking Support" class="md-nav__link">
    Flash Networking Support
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" title="Security Considerations" class="md-nav__link">
    Security Considerations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#library-background" title="Library Background" class="md-nav__link">
    Library Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contact" title="Contact" class="md-nav__link">
    Contact
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#donations" title="Donations" class="md-nav__link">
    Donations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/xeoinquedos/curso-webgis/edit/master/docs/openlayers/ol-googlemaps/node_modules/node-forge/README.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="forge">Forge</h1>
<p><a href="https://nodei.co/npm/node-forge/"><img alt="npm package" src="https://nodei.co/npm/node-forge.png?downloads=true&amp;downloadRank=true&amp;stars=true" /></a></p>
<p><a href="https://travis-ci.org/digitalbazaar/forge"><img alt="Build status" src="https://img.shields.io/travis/digitalbazaar/forge.svg?branch=master" /></a></p>
<p>A native implementation of <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> (and various other cryptographic tools) in
<a href="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a>.</p>
<h2 id="introduction">Introduction</h2>
<p>The Forge software is a fully native implementation of the <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> protocol
in JavaScript, a set of cryptography utilities, and a set of tools for
developing Web Apps that utilize many network resources.</p>
<h2 id="performance">Performance</h2>
<p>Forge is fast. Benchmarks against other popular JavaScript cryptography
libraries can be found here:</p>
<ul>
<li>http://dominictarr.github.io/crypto-bench/</li>
<li>http://cryptojs.altervista.org/test/simulate-threading-speed_test.html</li>
</ul>
<h2 id="documentation">Documentation</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#performance">Performance</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#contributing">Contributing</a></li>
</ul>
<h3 id="api">API</h3>
<ul>
<li><a href="#options">Options</a></li>
</ul>
<h3 id="transports">Transports</h3>
<ul>
<li><a href="#tls">TLS</a></li>
<li><a href="#http">HTTP</a></li>
<li><a href="#ssh">SSH</a></li>
<li><a href="#xhr">XHR</a></li>
<li><a href="#socket">Sockets</a></li>
</ul>
<h3 id="ciphers">Ciphers</h3>
<ul>
<li><a href="#cipher">CIPHER</a></li>
<li><a href="#aes">AES</a></li>
<li><a href="#des">DES</a></li>
<li><a href="#rc2">RC2</a></li>
</ul>
<h3 id="pki">PKI</h3>
<ul>
<li><a href="#ed25519">ED25519</a></li>
<li><a href="#rsa">RSA</a></li>
<li><a href="#rsakem">RSA-KEM</a></li>
<li><a href="#x509">X.509</a></li>
<li><a href="#pkcs5">PKCS#5</a></li>
<li><a href="#pkcs7">PKCS#7</a></li>
<li><a href="#pkcs8">PKCS#8</a></li>
<li><a href="#pkcs10">PKCS#10</a></li>
<li><a href="#pkcs12">PKCS#12</a></li>
<li><a href="#asn">ASN.1</a></li>
</ul>
<h3 id="message-digests">Message Digests</h3>
<ul>
<li><a href="#sha1">SHA1</a></li>
<li><a href="#sha256">SHA256</a></li>
<li><a href="#sha384">SHA384</a></li>
<li><a href="#sha512">SHA512</a></li>
<li><a href="#md5">MD5</a></li>
<li><a href="#hmac">HMAC</a></li>
</ul>
<h3 id="utilities">Utilities</h3>
<ul>
<li><a href="#prime">Prime</a></li>
<li><a href="#prng">PRNG</a></li>
<li><a href="#task">Tasks</a></li>
<li><a href="#util">Utilities</a></li>
<li><a href="#log">Logging</a></li>
<li><a href="#debug">Debugging</a></li>
<li><a href="#flash">Flash Networking Support</a></li>
</ul>
<h3 id="other">Other</h3>
<ul>
<li><a href="#security-considerations">Security Considerations</a></li>
<li><a href="#library-background">Library Background</a></li>
<li><a href="#contact">Contact</a></li>
<li><a href="#donations">Donations</a></li>
</ul>
<hr />
<h2 id="installation">Installation</h2>
<p><strong>Note</strong>: Please see the <a href="#security-considerations">Security Considerations</a>
section before using packaging systems and pre-built files.</p>
<p>Forge uses a <a href="https://en.wikipedia.org/wiki/CommonJS">CommonJS</a> module structure with a build process for browser
bundles. The older <a href="https://github.com/digitalbazaar/forge/tree/0.6.x">0.6.x</a> branch with standalone files is available but will
not be regularly updated.</p>
<h3 id="nodejs">Node.js</h3>
<p>If you want to use forge with <a href="http://nodejs.org/">Node.js</a>, it is available through <code>npm</code>:</p>
<p>https://npmjs.org/package/node-forge</p>
<p>Installation:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm install node-forge
</pre></div>
</td></tr></table>

<p>You can then use forge as a regular module:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">forge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-forge&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>The npm package includes pre-built <code>forge.min.js</code>, <code>forge.all.min.js</code>, and
<code>prime.worker.min.js</code> using the <a href="https://github.com/umdjs/umd">UMD</a> format.</p>
<h3 id="bundle-bower">Bundle / Bower</h3>
<p>Each release is published in a separate repository as pre-built and minimized
basic forge bundles using the <a href="https://github.com/umdjs/umd">UMD</a> format.</p>
<p>https://github.com/digitalbazaar/forge-dist</p>
<p>This bundle can be used in many environments. In particular it can be installed
with <a href="https://bower.io/">Bower</a>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>bower install forge
</pre></div>
</td></tr></table>

<h3 id="jsdelivr-cdn">jsDelivr CDN</h3>
<p>To use it via <a href="https://www.jsdelivr.com/package/npm/node-forge">jsDelivr</a> include this in your html:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/node-forge@0.7.0/dist/forge.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<h3 id="unpkg-cdn">unpkg CDN</h3>
<p>To use it via <a href="https://unpkg.com/#/">unpkg</a> include this in your html:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/node-forge@0.7.0/dist/forge.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<h3 id="development-requirements">Development Requirements</h3>
<p>The core JavaScript has the following requirements to build and test:</p>
<ul>
<li>Building a browser bundle:</li>
<li>Node.js</li>
<li>npm</li>
<li>Testing</li>
<li>Node.js</li>
<li>npm</li>
<li>Chrome, Firefox, Safari (optional)</li>
</ul>
<p>Some special networking features can optionally use a Flash component.  See the
<a href="flash/">Flash README</a> for details.</p>
<h3 id="building-for-a-web-browser">Building for a web browser</h3>
<p>To create single file bundles for use with browsers run the following:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm install
npm run build
</pre></div>
</td></tr></table>

<p>This will create single non-minimized and minimized files that can be
included in the browser:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>dist/forge.js
dist/forge.min.js
</pre></div>
</td></tr></table>

<p>A bundle that adds some utilities and networking support is also available:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>dist/forge.all.js
dist/forge.all.min.js
</pre></div>
</td></tr></table>

<p>Include the file via:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;YOUR_SCRIPT_PATH/forge.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>or</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;YOUR_SCRIPT_PATH/forge.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>The above bundles will synchronously create a global 'forge' object.</p>
<p><strong>Note</strong>: These bundles will not include any WebWorker scripts (eg:
<code>dist/prime.worker.js</code>), so these will need to be accessible from the browser
if any WebWorkers are used.</p>
<h3 id="building-a-custom-browser-bundle">Building a custom browser bundle</h3>
<p>The build process uses <a href="https://webpack.github.io/">webpack</a> and the <a href="./webpack.config.js">config</a> file
can be modified to generate a file or files that only contain the parts of
forge you need.</p>
<p><a href="http://browserify.org/">Browserify</a> override support is also present in <code>package.json</code>.</p>
<h2 id="testing">Testing</h2>
<p>See the <a href="./tests/README.md">testing README</a> for full details.</p>
<h3 id="prepare-to-run-tests">Prepare to run tests</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm install
</pre></div>
</td></tr></table>

<h3 id="running-automated-tests-with-nodejs">Running automated tests with Node.js</h3>
<p>Forge natively runs in a <a href="http://nodejs.org/">Node.js</a> environment:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm test
</pre></div>
</td></tr></table>

<h3 id="running-automated-tests-with-phantomjs">Running automated tests with PhantomJS</h3>
<p>Automated testing is done via <a href="https://karma-runner.github.io/">Karma</a>. By default it will run the tests in a
headless manner with PhantomJS.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm run test-karma
</pre></div>
</td></tr></table>

<p>Is 'mocha' reporter output too verbose? Other reporters are available. Try
'dots', 'progress', or 'tap'.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm run test-karma -- --reporters progress
</pre></div>
</td></tr></table>

<p>By default <a href="https://webpack.github.io/">webpack</a> is used. <a href="http://browserify.org/">Browserify</a> can also be used.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>BUNDLER=browserify npm run test-karma
</pre></div>
</td></tr></table>

<h3 id="running-automated-tests-with-one-or-more-browsers">Running automated tests with one or more browsers</h3>
<p>You can also specify one or more browsers to use.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm run test-karma -- --browsers Chrome,Firefox,Safari,PhantomJS
</pre></div>
</td></tr></table>

<p>The reporter option and <code>BUNDLER</code> environment variable can also be used.</p>
<h3 id="running-manual-tests-in-a-browser">Running manual tests in a browser</h3>
<p>Testing in a browser uses <a href="https://webpack.github.io/">webpack</a> to combine forge and all tests and then
loading the result in a browser. A simple web server is provided that will
output the HTTP or HTTPS URLs to load. It also will start a simple Flash Policy
Server. Unit tests and older legacy tests are provided. Custom ports can be
used by running <code>node tests/server.js</code> manually.</p>
<p>To run the unit tests in a browser a special forge build is required:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm run test-build
</pre></div>
</td></tr></table>

<p>To run legacy browser based tests the main forge build is required:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm run build
</pre></div>
</td></tr></table>

<p>The tests are run with a custom server that prints out the URLs to use:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm run test-server
</pre></div>
</td></tr></table>

<h3 id="running-other-tests">Running other tests</h3>
<p>There are some other random tests and benchmarks available in the tests
directory.</p>
<h3 id="coverage-testing">Coverage testing</h3>
<p>To perform coverage testing of the unit tests, run the following. The results
will be put in the <code>coverage/</code> directory. Note that coverage testing can slow
down some tests considerably.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm install
npm run coverage
</pre></div>
</td></tr></table>

<h2 id="contributing">Contributing</h2>
<p>Any contributions (eg: PRs) that are accepted will be brought under the same
license used by the rest of the Forge project. This license allows Forge to
be used under the terms of either the BSD License or the GNU General Public
License (GPL) Version 2.</p>
<p>See: <a href="https://github.com/digitalbazaar/forge/blob/cbebca3780658703d925b61b2caffb1d263a6c1d/LICENSE">LICENSE</a></p>
<p>If a contribution contains 3rd party source code with its own license, it
may retain it, so long as that license is compatible with the Forge license.</p>
<h2 id="api_1">API</h2>
<p><a name="options" /></p>
<h3 id="options">Options</h3>
<p>If at any time you wish to disable the use of native code, where available,
for particular forge features like its secure random number generator, you
may set the <code>forge.options.usePureJavaScript</code> flag to <code>true</code>. It is
not recommended that you set this flag as native code is typically more
performant and may have stronger security properties. It may be useful to
set this flag to test certain features that you plan to run in environments
that are different from your testing environment.</p>
<p>To disable native code when including forge in the browser:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// run this *after* including the forge script</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">usePureJavaScript</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>To disable native code when using Node.js:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">forge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-forge&#39;</span><span class="p">);</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">usePureJavaScript</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h2 id="transports_1">Transports</h2>
<p><a name="tls" /></p>
<h3 id="tls">TLS</h3>
<p>Provides a native javascript client and server-side <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> implementation.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// create TLS client</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="nx">server</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">caStore</span><span class="o">:</span> <span class="cm">/* Array of PEM-formatted certs or a CA store object */</span><span class="p">,</span>
  <span class="nx">sessionCache</span><span class="o">:</span> <span class="p">{},</span>
  <span class="c1">// supported cipher suites in order of preference</span>
  <span class="nx">cipherSuites</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">CipherSuites</span><span class="p">.</span><span class="nx">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="p">,</span>
    <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">CipherSuites</span><span class="p">.</span><span class="nx">TLS_RSA_WITH_AES_256_CBC_SHA</span><span class="p">],</span>
  <span class="nx">virtualHost</span><span class="o">:</span> <span class="s1">&#39;example.com&#39;</span><span class="p">,</span>
  <span class="nx">verify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">verified</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">certs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">depth</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cn</span> <span class="o">=</span> <span class="nx">certs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">subject</span><span class="p">.</span><span class="nx">getField</span><span class="p">(</span><span class="s1">&#39;CN&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">cn</span> <span class="o">!==</span> <span class="s1">&#39;example.com&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">verified</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Alert</span><span class="p">.</span><span class="nx">Description</span><span class="p">.</span><span class="nx">bad_certificate</span><span class="p">,</span>
          <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Certificate common name does not match hostname.&#39;</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">verified</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">connected</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;connected&#39;</span><span class="p">);</span>
    <span class="c1">// send message to server</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">encodeUtf8</span><span class="p">(</span><span class="s1">&#39;Hi server!&#39;</span><span class="p">));</span>
    <span class="cm">/* NOTE: experimental, start heartbeat retransmission timer</span>
<span class="cm">    myHeartbeatTimer = setInterval(function() {</span>
<span class="cm">      connection.prepareHeartbeatRequest(forge.util.createBuffer(&#39;1234&#39;));</span>
<span class="cm">    }, 5*60*1000);*/</span>
  <span class="p">},</span>
  <span class="cm">/* provide a client-side cert if you want</span>
<span class="cm">  getCertificate: function(connection, hint) {</span>
<span class="cm">    return myClientCertificate;</span>
<span class="cm">  },</span>
<span class="cm">  /* the private key for the client-side cert if provided */</span>
  <span class="nx">getPrivateKey</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">cert</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">myClientPrivateKey</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">tlsDataReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// TLS data (encrypted) is ready to be sent to the server</span>
    <span class="nx">sendToServerSomehow</span><span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">tlsData</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">());</span>
    <span class="c1">// if you were communicating with the server below, you&#39;d do:</span>
    <span class="c1">// server.process(connection.tlsData.getBytes());</span>
  <span class="p">},</span>
  <span class="nx">dataReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// clear data from the server is ready</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;the server sent: &#39;</span> <span class="o">+</span>
      <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decodeUtf8</span><span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">()));</span>
    <span class="c1">// close connection</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="cm">/* NOTE: experimental</span>
<span class="cm">  heartbeatReceived: function(connection, payload) {</span>
<span class="cm">    // restart retransmission timer, look at payload</span>
<span class="cm">    clearInterval(myHeartbeatTimer);</span>
<span class="cm">    myHeartbeatTimer = setInterval(function() {</span>
<span class="cm">      connection.prepareHeartbeatRequest(forge.util.createBuffer(&#39;1234&#39;));</span>
<span class="cm">    }, 5*60*1000);</span>
<span class="cm">    payload.getBytes();</span>
<span class="cm">  },*/</span>
  <span class="nx">closed</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;disconnected&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;uh oh&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// start the handshake process</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">handshake</span><span class="p">();</span>

<span class="c1">// when encrypted TLS data is received from the server, process it</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="nx">encryptedBytesFromServer</span><span class="p">);</span>

<span class="c1">// create TLS server</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="nx">server</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">caStore</span><span class="o">:</span> <span class="cm">/* Array of PEM-formatted certs or a CA store object */</span><span class="p">,</span>
  <span class="nx">sessionCache</span><span class="o">:</span> <span class="p">{},</span>
  <span class="c1">// supported cipher suites in order of preference</span>
  <span class="nx">cipherSuites</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">CipherSuites</span><span class="p">.</span><span class="nx">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="p">,</span>
    <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">CipherSuites</span><span class="p">.</span><span class="nx">TLS_RSA_WITH_AES_256_CBC_SHA</span><span class="p">],</span>
  <span class="c1">// require a client-side certificate if you want</span>
  <span class="nx">verifyClient</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">verify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">verified</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">certs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">depth</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cn</span> <span class="o">=</span> <span class="nx">certs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">subject</span><span class="p">.</span><span class="nx">getField</span><span class="p">(</span><span class="s1">&#39;CN&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">cn</span> <span class="o">!==</span> <span class="s1">&#39;the-client&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">verified</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Alert</span><span class="p">.</span><span class="nx">Description</span><span class="p">.</span><span class="nx">bad_certificate</span><span class="p">,</span>
          <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Certificate common name does not match expected client.&#39;</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">verified</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">connected</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;connected&#39;</span><span class="p">);</span>
    <span class="c1">// send message to client</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">encodeUtf8</span><span class="p">(</span><span class="s1">&#39;Hi client!&#39;</span><span class="p">));</span>
    <span class="cm">/* NOTE: experimental, start heartbeat retransmission timer</span>
<span class="cm">    myHeartbeatTimer = setInterval(function() {</span>
<span class="cm">      connection.prepareHeartbeatRequest(forge.util.createBuffer(&#39;1234&#39;));</span>
<span class="cm">    }, 5*60*1000);*/</span>
  <span class="p">},</span>
  <span class="nx">getCertificate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">hint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">myServerCertificate</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">getPrivateKey</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">cert</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">myServerPrivateKey</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">tlsDataReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// TLS data (encrypted) is ready to be sent to the client</span>
    <span class="nx">sendToClientSomehow</span><span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">tlsData</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">());</span>
    <span class="c1">// if you were communicating with the client above you&#39;d do:</span>
    <span class="c1">// client.process(connection.tlsData.getBytes());</span>
  <span class="p">},</span>
  <span class="nx">dataReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// clear data from the client is ready</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;the client sent: &#39;</span> <span class="o">+</span>
      <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decodeUtf8</span><span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">()));</span>
    <span class="c1">// close connection</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="cm">/* NOTE: experimental</span>
<span class="cm">  heartbeatReceived: function(connection, payload) {</span>
<span class="cm">    // restart retransmission timer, look at payload</span>
<span class="cm">    clearInterval(myHeartbeatTimer);</span>
<span class="cm">    myHeartbeatTimer = setInterval(function() {</span>
<span class="cm">      connection.prepareHeartbeatRequest(forge.util.createBuffer(&#39;1234&#39;));</span>
<span class="cm">    }, 5*60*1000);</span>
<span class="cm">    payload.getBytes();</span>
<span class="cm">  },*/</span>
  <span class="nx">closed</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;disconnected&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;uh oh&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// when encrypted TLS data is received from the client, process it</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="nx">encryptedBytesFromClient</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Connect to a TLS server using node's net.Socket:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Socket</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">tls</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
  <span class="nx">server</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">verify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">verified</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">certs</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// skip verification for testing</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[tls] server certificate verified&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">connected</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[tls] connected&#39;</span><span class="p">);</span>
    <span class="c1">// prepare some data to send (note that the string is interpreted as</span>
    <span class="c1">// &#39;binary&#39; encoded, which works for HTTP which only uses ASCII, use</span>
    <span class="c1">// forge.util.encodeUtf8(str) otherwise</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="s1">&#39;GET / HTTP/1.0\r\n\r\n&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">tlsDataReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// encrypted data is ready to be sent to the server</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">tlsData</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">);</span> <span class="c1">// encoding should be &#39;binary&#39;</span>
  <span class="p">},</span>
  <span class="nx">dataReady</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// clear data from the server is ready</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[tls] data received from the server: &#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">closed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[tls] disconnected&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[tls] error&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[socket] connected&#39;</span><span class="p">);</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">handshake</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">client</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">));</span> <span class="c1">// encoding should be &#39;binary&#39;</span>
<span class="p">});</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[socket] disconnected&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// connect to google.com</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="mi">443</span><span class="p">,</span> <span class="s1">&#39;google.com&#39;</span><span class="p">);</span>

<span class="c1">// or connect to gmail&#39;s imap server (but don&#39;t send the HTTP header above)</span>
<span class="c1">//socket.connect(993, &#39;imap.gmail.com&#39;);</span>
</pre></div>
</td></tr></table>

<p><a name="http" /></p>
<h3 id="http">HTTP</h3>
<p>Provides a native <a href="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a> mini-implementation of an http client that
uses pooled sockets.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// create an HTTP GET request</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">createRequest</span><span class="p">({</span><span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="nx">url</span><span class="p">.</span><span class="nx">path</span><span class="p">});</span>

<span class="c1">// send the request somewhere</span>
<span class="nx">sendSomehow</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>

<span class="c1">// receive response</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">createResponse</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">someAsyncDataHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">bodyReceived</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">buffer</span><span class="p">.</span><span class="nx">putBytes</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">headerReceived</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">readHeader</span><span class="p">(</span><span class="nx">buffer</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;HTTP response header: &#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headerReceived</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">bodyReceived</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">readBody</span><span class="p">(</span><span class="nx">buffer</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;HTTP response body: &#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>

<p><a name="ssh" /></p>
<h3 id="ssh">SSH</h3>
<p>Provides some SSH utility functions.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// encodes (and optionally encrypts) a private RSA key as a Putty PPK file</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">privateKeyToPutty</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">passphrase</span><span class="p">,</span> <span class="nx">comment</span><span class="p">);</span>

<span class="c1">// encodes a public RSA key as an OpenSSH file</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">publicKeyToOpenSSH</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">comment</span><span class="p">);</span>

<span class="c1">// encodes a private RSA key as an OpenSSH file</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">privateKeyToOpenSSH</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">passphrase</span><span class="p">);</span>

<span class="c1">// gets the SSH public key fingerprint in a byte buffer</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

<span class="c1">// gets a hex-encoded, colon-delimited SSH public key fingerprint</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">ssh</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;hex&#39;</span><span class="p">,</span> <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;:&#39;</span><span class="p">});</span>
</pre></div>
</td></tr></table>

<p><a name="xhr" /></p>
<h3 id="xhr">XHR</h3>
<p>Provides an XmlHttpRequest implementation using forge.http as a backend.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TODO</span>
</pre></div>
</td></tr></table>

<p><a name="socket" /></p>
<h3 id="sockets">Sockets</h3>
<p>Provides an interface to create and use raw sockets provided via Flash.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TODO</span>
</pre></div>
</td></tr></table>

<h2 id="ciphers_1">Ciphers</h2>
<p><a name="cipher" /></p>
<h3 id="cipher">CIPHER</h3>
<p>Provides a basic API for block encryption and decryption. There is built-in
support for the ciphers: <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>, <a href="http://en.wikipedia.org/wiki/Triple_DES">3DES</a>, and <a href="http://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a>, and for the modes
of operation: <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">ECB</a>, <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CBC</a>, <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CFB</a>, <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">OFB</a>, <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CTR</a>, and <a href="http://en.wikipedia.org/wiki/GCM_mode">GCM</a>.</p>
<p>These algorithms are currently supported:</p>
<ul>
<li>AES-ECB</li>
<li>AES-CBC</li>
<li>AES-CFB</li>
<li>AES-OFB</li>
<li>AES-CTR</li>
<li>AES-GCM</li>
<li>3DES-ECB</li>
<li>3DES-CBC</li>
<li>DES-ECB</li>
<li>DES-CBC</li>
</ul>
<p>When using an <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> algorithm, the key size will determine whether
AES-128, AES-192, or AES-256 is used (all are supported). When a <a href="http://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a>
algorithm is used, the key size will determine whether <a href="http://en.wikipedia.org/wiki/Triple_DES">3DES</a> or regular
<a href="http://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a> is used. Use a <a href="http://en.wikipedia.org/wiki/Triple_DES">3DES</a> algorithm to enforce Triple-DES.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// generate a random key and IV</span>
<span class="c1">// Note: a key size of 16 bytes will use AES-128, 24 =&gt; AES-192, 32 =&gt; AES-256</span>
<span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>

<span class="cm">/* alternatively, generate a password-based 16-byte key</span>
<span class="cm">var salt = forge.random.getBytesSync(128);</span>
<span class="cm">var key = forge.pkcs5.pbkdf2(&#39;password&#39;, salt, numIterations, 16);</span>
<span class="cm">*/</span>

<span class="c1">// encrypt some bytes using CBC mode</span>
<span class="c1">// (other modes include: ECB, CFB, OFB, CTR, and GCM)</span>
<span class="c1">// Note: CBC and ECB modes use PKCS#7 padding as default</span>
<span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="s1">&#39;AES-CBC&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">});</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">someBytes</span><span class="p">));</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">output</span><span class="p">;</span>
<span class="c1">// outputs encrypted hex</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>

<span class="c1">// decrypt some bytes using CBC mode</span>
<span class="c1">// (other modes include: CFB, OFB, CTR, and GCM)</span>
<span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="s1">&#39;AES-CBC&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">});</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span> <span class="c1">// check &#39;result&#39; for true/false</span>
<span class="c1">// outputs decrypted hex</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>

<span class="c1">// decrypt bytes using CBC mode and streaming</span>
<span class="c1">// Performance can suffer for large multi-MB inputs due to buffer</span>
<span class="c1">// manipulations. Stream processing in chunks can offer significant</span>
<span class="c1">// improvement. CPU intensive update() calls could also be performed with</span>
<span class="c1">// setImmediate/setTimeout to avoid blocking the main browser UI thread (not</span>
<span class="c1">// shown here). Optimal block size depends on the JavaScript VM and other</span>
<span class="c1">// factors. Encryption can use a simple technique for increased performance.</span>
<span class="kd">var</span> <span class="nx">encryptedBytes</span> <span class="o">=</span> <span class="nx">encrypted</span><span class="p">.</span><span class="nx">bytes</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="s1">&#39;AES-CBC&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">encryptedBytes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">chunkSize</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">64</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="nx">decrypted</span> <span class="o">+=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">encryptedBytes</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">chunkSize</span><span class="p">));</span>
  <span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
  <span class="nx">index</span> <span class="o">+=</span> <span class="nx">chunkSize</span><span class="p">;</span>
<span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="nx">assert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="nx">decrypted</span> <span class="o">+=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">bytesToHex</span><span class="p">(</span><span class="nx">decrypted</span><span class="p">));</span>

<span class="c1">// encrypt some bytes using GCM mode</span>
<span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="s1">&#39;AES-GCM&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
  <span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">,</span> <span class="c1">// should be a 12-byte binary-encoded string or byte buffer</span>
  <span class="nx">additionalData</span><span class="o">:</span> <span class="s1">&#39;binary-encoded string&#39;</span><span class="p">,</span> <span class="c1">// optional</span>
  <span class="nx">tagLength</span><span class="o">:</span> <span class="mi">128</span> <span class="c1">// optional, defaults to 128 bits</span>
<span class="p">});</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">someBytes</span><span class="p">));</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">output</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">tag</span><span class="p">;</span>
<span class="c1">// outputs encrypted hex</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// outputs authentication tag</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>

<span class="c1">// decrypt some bytes using GCM mode</span>
<span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="s1">&#39;AES-GCM&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
  <span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">,</span>
  <span class="nx">additionalData</span><span class="o">:</span> <span class="s1">&#39;binary-encoded string&#39;</span><span class="p">,</span> <span class="c1">// optional</span>
  <span class="nx">tagLength</span><span class="o">:</span> <span class="mi">128</span><span class="p">,</span> <span class="c1">// optional, defaults to 128 bits</span>
  <span class="nx">tag</span><span class="o">:</span> <span class="nx">tag</span> <span class="c1">// authentication tag from encryption</span>
<span class="p">});</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="c1">// pass is false if there was a failure (eg: authentication tag didn&#39;t match)</span>
<span class="k">if</span><span class="p">(</span><span class="nx">pass</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// outputs decrypted hex</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Using forge in Node.js to match openssl's "enc" command line tool (<strong>Note</strong>: OpenSSL "enc" uses a non-standard file format with a custom key derivation function and a fixed iteration count of 1, which some consider less secure than alternatives such as <a href="https://tools.ietf.org/html/rfc4880">OpenPGP</a>/<a href="https://www.gnupg.org/">GnuPG</a>):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">forge</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-forge&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// openssl enc -des3 -in input.txt -out input.enc</span>
<span class="kd">function</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;input.txt&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;binary&#39;</span><span class="p">});</span>

  <span class="c1">// 3DES key and IV sizes</span>
  <span class="kd">var</span> <span class="nx">keySize</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">ivSize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

  <span class="c1">// get derived bytes</span>
  <span class="c1">// Notes:</span>
  <span class="c1">// 1. If using an alternative hash (eg: &quot;-md sha1&quot;) pass</span>
  <span class="c1">//   &quot;forge.md.sha1.create()&quot; as the final parameter.</span>
  <span class="c1">// 2. If using &quot;-nosalt&quot;, set salt to null.</span>
  <span class="kd">var</span> <span class="nx">salt</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
  <span class="c1">// var md = forge.md.sha1.create(); // &quot;-md sha1&quot;</span>
  <span class="kd">var</span> <span class="nx">derivedBytes</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pbe</span><span class="p">.</span><span class="nx">opensslDeriveBytes</span><span class="p">(</span>
    <span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="nx">keySize</span> <span class="o">+</span> <span class="nx">ivSize</span><span class="cm">/*, md*/</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">derivedBytes</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="nx">keySize</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="nx">ivSize</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="s1">&#39;3DES-CBC&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
  <span class="nx">cipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">});</span>
  <span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">));</span>
  <span class="nx">cipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>

  <span class="c1">// if using a salt, prepend this to the output:</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">salt</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span><span class="p">.</span><span class="nx">putBytes</span><span class="p">(</span><span class="s1">&#39;Salted__&#39;</span><span class="p">);</span> <span class="c1">// (add to match openssl tool output)</span>
    <span class="nx">output</span><span class="p">.</span><span class="nx">putBytes</span><span class="p">(</span><span class="nx">salt</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">output</span><span class="p">.</span><span class="nx">putBuffer</span><span class="p">(</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">output</span><span class="p">);</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;input.enc&#39;</span><span class="p">,</span> <span class="nx">output</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(),</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;binary&#39;</span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// openssl enc -d -des3 -in input.enc -out input.dec.txt</span>
<span class="kd">function</span> <span class="nx">decrypt</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;input.enc&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;binary&#39;</span><span class="p">});</span>

  <span class="c1">// parse salt from input</span>
  <span class="nx">input</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">);</span>
  <span class="c1">// skip &quot;Salted__&quot; (if known to be present)</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="s1">&#39;Salted__&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="c1">// read 8-byte salt</span>
  <span class="kd">var</span> <span class="nx">salt</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

  <span class="c1">// Note: if using &quot;-nosalt&quot;, skip above parsing and use</span>
  <span class="c1">// var salt = null;</span>

  <span class="c1">// 3DES key and IV sizes</span>
  <span class="kd">var</span> <span class="nx">keySize</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">ivSize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">derivedBytes</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pbe</span><span class="p">.</span><span class="nx">opensslDeriveBytes</span><span class="p">(</span>
    <span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="nx">keySize</span> <span class="o">+</span> <span class="nx">ivSize</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">derivedBytes</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="nx">keySize</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="nx">ivSize</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="s1">&#39;3DES-CBC&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
  <span class="nx">decipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">});</span>
  <span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span> <span class="c1">// check &#39;result&#39; for true/false</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="s1">&#39;input.dec.txt&#39;</span><span class="p">,</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(),</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;binary&#39;</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p><a name="aes" /></p>
<h3 id="aes">AES</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> encryption and decryption in <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CBC</a>, <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CFB</a>, <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">OFB</a>,
<a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CTR</a>, and <a href="http://en.wikipedia.org/wiki/GCM_mode">GCM</a> modes. See <a href="#cipher">CIPHER</a> for examples.</p>
<p><a name="des" /></p>
<h3 id="des">DES</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/Triple_DES">3DES</a> and <a href="http://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a> encryption and decryption in <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">ECB</a> and
<a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">CBC</a> modes. See <a href="#cipher">CIPHER</a> for examples.</p>
<p><a name="rc2" /></p>
<h3 id="rc2">RC2</h3>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// generate a random key and IV</span>
<span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

<span class="c1">// encrypt some bytes</span>
<span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">rc2</span><span class="p">.</span><span class="nx">createEncryptionCipher</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">iv</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">someBytes</span><span class="p">));</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">output</span><span class="p">;</span>
<span class="c1">// outputs encrypted hex</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>

<span class="c1">// decrypt some bytes</span>
<span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">rc2</span><span class="p">.</span><span class="nx">createDecryptionCipher</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">iv</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="c1">// outputs decrypted hex</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">toHex</span><span class="p">());</span>
</pre></div>
</td></tr></table>

<h2 id="pki_1">PKI</h2>
<p>Provides <a href="http://en.wikipedia.org/wiki/X.509">X.509</a> certificate support, ED25519 key generation and
signing/verifying, and RSA public and private key encoding, decoding,
encryption/decryption, and signing/verifying.</p>
<p><a name="ed25519" /></p>
<h3 id="ed25519">ED25519</h3>
<p>Special thanks to [TweetNaCl.js][] for providing the bulk of the implementation.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">ed25519</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">ed25519</span><span class="p">;</span>

<span class="c1">// generate a random ED25519 keypair</span>
<span class="kd">var</span> <span class="nx">keypair</span> <span class="o">=</span> <span class="nx">ed25519</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">();</span>
<span class="c1">// `keypair.publicKey` is a node.js Buffer or Uint8Array</span>
<span class="c1">// `keypair.privateKey` is a node.js Buffer or Uint8Array</span>

<span class="c1">// generate a random ED25519 keypair based on a random 32-byte seed</span>
<span class="kd">var</span> <span class="nx">seed</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">keypair</span> <span class="o">=</span> <span class="nx">ed25519</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">({</span><span class="nx">seed</span><span class="o">:</span> <span class="nx">seed</span><span class="p">});</span>

<span class="c1">// generate a random ED25519 keypair based on a &quot;password&quot; 32-byte seed</span>
<span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="s1">&#39;Mai9ohgh6ahxee0jutheew0pungoozil&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">seed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ByteBuffer</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">keypair</span> <span class="o">=</span> <span class="nx">ed25519</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">({</span><span class="nx">seed</span><span class="o">:</span> <span class="nx">seed</span><span class="p">});</span>

<span class="c1">// sign a UTF-8 message</span>
<span class="kd">var</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">ED25519</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span>
  <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
  <span class="c1">// also accepts `binary` if you want to pass a binary string</span>
  <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, binary string</span>
  <span class="nx">privateKey</span><span class="o">:</span> <span class="nx">privateKey</span>
<span class="p">});</span>
<span class="c1">// `signature` is a node.js Buffer or Uint8Array</span>

<span class="c1">// sign a message passed as a buffer</span>
<span class="kd">var</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">ED25519</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span>
  <span class="c1">// also accepts a forge ByteBuffer or Uint8Array</span>
  <span class="nx">message</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">),</span>
  <span class="nx">privateKey</span><span class="o">:</span> <span class="nx">privateKey</span>
<span class="p">});</span>

<span class="c1">// sign a message digest (shorter &quot;message&quot; == better performance)</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">ED25519</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">md</span><span class="p">,</span>
  <span class="nx">privateKey</span><span class="o">:</span> <span class="nx">privateKey</span>
<span class="p">});</span>

<span class="c1">// verify a signature on a UTF-8 message</span>
<span class="kd">var</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">ED25519</span><span class="p">.</span><span class="nx">verify</span><span class="p">({</span>
  <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
  <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, or binary string</span>
  <span class="nx">signature</span><span class="o">:</span> <span class="nx">signature</span><span class="p">,</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, or binary string</span>
  <span class="nx">publicKey</span><span class="o">:</span> <span class="nx">publicKey</span>
<span class="p">});</span>
<span class="c1">// `verified` is true/false</span>

<span class="c1">// sign a message passed as a buffer</span>
<span class="kd">var</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">ED25519</span><span class="p">.</span><span class="nx">verify</span><span class="p">({</span>
  <span class="c1">// also accepts a forge ByteBuffer or Uint8Array</span>
  <span class="nx">message</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">),</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, or binary string</span>
  <span class="nx">signature</span><span class="o">:</span> <span class="nx">signature</span><span class="p">,</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, or binary string</span>
  <span class="nx">publicKey</span><span class="o">:</span> <span class="nx">publicKey</span>
<span class="p">});</span>

<span class="c1">// verify a signature on a message digest</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">ED25519</span><span class="p">.</span><span class="nx">verify</span><span class="p">({</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">md</span><span class="p">,</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, or binary string</span>
  <span class="nx">signature</span><span class="o">:</span> <span class="nx">signature</span><span class="p">,</span>
  <span class="c1">// node.js Buffer, Uint8Array, forge ByteBuffer, or binary string</span>
  <span class="nx">publicKey</span><span class="o">:</span> <span class="nx">publicKey</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p><a name="rsa" /></p>
<h3 id="rsa">RSA</h3>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">rsa</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">;</span>

<span class="c1">// generate an RSA key pair synchronously</span>
<span class="c1">// *NOT RECOMMENDED* -- can be significantly slower than async and will not</span>
<span class="c1">// use native APIs if available.</span>
<span class="kd">var</span> <span class="nx">keypair</span> <span class="o">=</span> <span class="nx">rsa</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">({</span><span class="nx">bits</span><span class="o">:</span> <span class="mi">2048</span><span class="p">,</span> <span class="nx">e</span><span class="o">:</span> <span class="mh">0x10001</span><span class="p">});</span>

<span class="c1">// generate an RSA key pair asynchronously (uses web workers if available)</span>
<span class="c1">// use workers: -1 to run a fast core estimator to optimize # of workers</span>
<span class="c1">// *RECOMMENDED* - can be significantly faster than sync -- and will use</span>
<span class="c1">// native APIs if available.</span>
<span class="nx">rsa</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">({</span><span class="nx">bits</span><span class="o">:</span> <span class="mi">2048</span><span class="p">,</span> <span class="nx">workers</span><span class="o">:</span> <span class="mi">2</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">keypair</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// keypair.privateKey, keypair.publicKey</span>
<span class="p">});</span>

<span class="c1">// generate an RSA key pair in steps that attempt to run for a specified period</span>
<span class="c1">// of time on the main JS thread</span>
<span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">rsa</span><span class="p">.</span><span class="nx">createKeyPairGenerationState</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mh">0x10001</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">step</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// run for 100 ms</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">rsa</span><span class="p">.</span><span class="nx">stepKeyPairGenerationState</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// done, turn off progress indicator, use state.keys</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// turn on progress indicator, schedule generation to run</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>

<span class="c1">// sign data with a private key and output DigestInfo DER-encoded bytes</span>
<span class="c1">// (defaults to RSASSA PKCS#1 v1.5)</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;sign this&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">md</span><span class="p">);</span>

<span class="c1">// verify data with a public key</span>
<span class="c1">// (defaults to RSASSA PKCS#1 v1.5)</span>
<span class="kd">var</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">bytes</span><span class="p">(),</span> <span class="nx">signature</span><span class="p">);</span>

<span class="c1">// sign data using RSASSA-PSS where PSS uses a SHA-1 hash, a SHA-1 based</span>
<span class="c1">// masking function MGF1, and a 20 byte salt</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;sign this&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pss</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pss</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
  <span class="nx">mgf</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">mgf</span><span class="p">.</span><span class="nx">mgf1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">()),</span>
  <span class="nx">saltLength</span><span class="o">:</span> <span class="mi">20</span>
  <span class="c1">// optionally pass &#39;prng&#39; with a custom PRNG implementation</span>
  <span class="c1">// optionalls pass &#39;salt&#39; with a forge.util.ByteBuffer w/custom salt</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">md</span><span class="p">,</span> <span class="nx">pss</span><span class="p">);</span>

<span class="c1">// verify RSASSA-PSS signature</span>
<span class="kd">var</span> <span class="nx">pss</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pss</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
  <span class="nx">mgf</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">mgf</span><span class="p">.</span><span class="nx">mgf1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">()),</span>
  <span class="nx">saltLength</span><span class="o">:</span> <span class="mi">20</span>
  <span class="c1">// optionally pass &#39;prng&#39; with a custom PRNG implementation</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;sign this&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="nx">publicKey</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">getBytes</span><span class="p">(),</span> <span class="nx">signature</span><span class="p">,</span> <span class="nx">pss</span><span class="p">);</span>

<span class="c1">// encrypt data with a public key (defaults to RSAES PKCS#1 v1.5)</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>

<span class="c1">// decrypt data with a private key (defaults to RSAES PKCS#1 v1.5)</span>
<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">);</span>

<span class="c1">// encrypt data with a public key using RSAES PKCS#1 v1.5</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="s1">&#39;RSAES-PKCS1-V1_5&#39;</span><span class="p">);</span>

<span class="c1">// decrypt data with a private key using RSAES PKCS#1 v1.5</span>
<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="s1">&#39;RSAES-PKCS1-V1_5&#39;</span><span class="p">);</span>

<span class="c1">// encrypt data with a public key using RSAES-OAEP</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="s1">&#39;RSA-OAEP&#39;</span><span class="p">);</span>

<span class="c1">// decrypt data with a private key using RSAES-OAEP</span>
<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="s1">&#39;RSA-OAEP&#39;</span><span class="p">);</span>

<span class="c1">// encrypt data with a public key using RSAES-OAEP/SHA-256</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="s1">&#39;RSA-OAEP&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// decrypt data with a private key using RSAES-OAEP/SHA-256</span>
<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="s1">&#39;RSA-OAEP&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// encrypt data with a public key using RSAES-OAEP/SHA-256/MGF1-SHA-1</span>
<span class="c1">// compatible with Java&#39;s RSA/ECB/OAEPWithSHA-256AndMGF1Padding</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="s1">&#39;RSA-OAEP&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
  <span class="nx">mgf1</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// decrypt data with a private key using RSAES-OAEP/SHA-256/MGF1-SHA-1</span>
<span class="c1">// compatible with Java&#39;s RSA/ECB/OAEPWithSHA-256AndMGF1Padding</span>
<span class="kd">var</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span> <span class="s1">&#39;RSA-OAEP&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
  <span class="nx">mgf1</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p><a name="rsakem" /></p>
<h3 id="rsa-kem">RSA-KEM</h3>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// generate an RSA key pair asynchronously (uses web workers if available)</span>
<span class="c1">// use workers: -1 to run a fast core estimator to optimize # of workers</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">({</span><span class="nx">bits</span><span class="o">:</span> <span class="mi">2048</span><span class="p">,</span> <span class="nx">workers</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">keypair</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// keypair.privateKey, keypair.publicKey</span>
<span class="p">});</span>

<span class="c1">// generate and encapsulate a 16-byte secret key</span>
<span class="kd">var</span> <span class="nx">kdf1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">kem</span><span class="p">.</span><span class="nx">kdf1</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">());</span>
<span class="kd">var</span> <span class="nx">kem</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">kem</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">kdf1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">kem</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">keypair</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="c1">// result has &#39;encapsulation&#39; and &#39;key&#39;</span>

<span class="c1">// encrypt some bytes</span>
<span class="kd">var</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">someBytes</span> <span class="o">=</span> <span class="s1">&#39;hello world!&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="s1">&#39;AES-GCM&#39;</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">});</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">someBytes</span><span class="p">));</span>
<span class="nx">cipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">encrypted</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nx">mode</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">();</span>

<span class="c1">// send &#39;encrypted&#39;, &#39;iv&#39;, &#39;tag&#39;, and result.encapsulation to recipient</span>

<span class="c1">// decrypt encapsulated 16-byte secret key</span>
<span class="kd">var</span> <span class="nx">kdf1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">kem</span><span class="p">.</span><span class="nx">kdf1</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">());</span>
<span class="kd">var</span> <span class="nx">kem</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">kem</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">kdf1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">kem</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">keypair</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">encapsulation</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

<span class="c1">// decrypt some bytes</span>
<span class="kd">var</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">cipher</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="s1">&#39;AES-GCM&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="nx">iv</span><span class="o">:</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span> <span class="nx">tag</span><span class="p">});</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">decipher</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
<span class="c1">// pass is false if there was a failure (eg: authentication tag didn&#39;t match)</span>
<span class="k">if</span><span class="p">(</span><span class="nx">pass</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// outputs &#39;hello world!&#39;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decipher</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p><a name="x509" /></p>
<h3 id="x509">X.509</h3>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">pki</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">;</span>

<span class="c1">// convert a PEM-formatted public key to a Forge public key</span>
<span class="kd">var</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">publicKeyFromPem</span><span class="p">(</span><span class="nx">pem</span><span class="p">);</span>

<span class="c1">// convert a Forge public key to PEM-format</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">publicKeyToPem</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">);</span>

<span class="c1">// convert an ASN.1 SubjectPublicKeyInfo to a Forge public key</span>
<span class="kd">var</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">publicKeyFromAsn1</span><span class="p">(</span><span class="nx">subjectPublicKeyInfo</span><span class="p">);</span>

<span class="c1">// convert a Forge public key to an ASN.1 SubjectPublicKeyInfo</span>
<span class="kd">var</span> <span class="nx">subjectPublicKeyInfo</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">publicKeyToAsn1</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">);</span>

<span class="c1">// gets a SHA-1 RSAPublicKey fingerprint a byte buffer</span>
<span class="nx">pki</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>

<span class="c1">// gets a SHA-1 SubjectPublicKeyInfo fingerprint a byte buffer</span>
<span class="nx">pki</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;SubjectPublicKeyInfo&#39;</span><span class="p">});</span>

<span class="c1">// gets a hex-encoded, colon-delimited SHA-1 RSAPublicKey public key fingerprint</span>
<span class="nx">pki</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;hex&#39;</span><span class="p">,</span> <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;:&#39;</span><span class="p">});</span>

<span class="c1">// gets a hex-encoded, colon-delimited SHA-1 SubjectPublicKeyInfo public key fingerprint</span>
<span class="nx">pki</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;SubjectPublicKeyInfo&#39;</span><span class="p">,</span>
  <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;hex&#39;</span><span class="p">,</span>
  <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;:&#39;</span>
<span class="p">});</span>

<span class="c1">// gets a hex-encoded, colon-delimited MD5 RSAPublicKey public key fingerprint</span>
<span class="nx">pki</span><span class="p">.</span><span class="nx">getPublicKeyFingerprint</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">md</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">md5</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
  <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;hex&#39;</span><span class="p">,</span>
  <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;:&#39;</span>
<span class="p">});</span>

<span class="c1">// creates a CA store</span>
<span class="kd">var</span> <span class="nx">caStore</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">createCaStore</span><span class="p">([</span><span class="cm">/* PEM-encoded cert */</span><span class="p">,</span> <span class="p">...]);</span>

<span class="c1">// add a certificate to the CA store</span>
<span class="nx">caStore</span><span class="p">.</span><span class="nx">addCertificate</span><span class="p">(</span><span class="nx">certObjectOrPemString</span><span class="p">);</span>

<span class="c1">// gets the issuer (its certificate) for the given certificate</span>
<span class="kd">var</span> <span class="nx">issuerCert</span> <span class="o">=</span> <span class="nx">caStore</span><span class="p">.</span><span class="nx">getIssuer</span><span class="p">(</span><span class="nx">subjectCert</span><span class="p">);</span>

<span class="c1">// verifies a certificate chain against a CA store</span>
<span class="nx">pki</span><span class="p">.</span><span class="nx">verifyCertificateChain</span><span class="p">(</span><span class="nx">caStore</span><span class="p">,</span> <span class="nx">chain</span><span class="p">,</span> <span class="nx">customVerifyCallback</span><span class="p">);</span>

<span class="c1">// signs a certificate using the given private key</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">);</span>

<span class="c1">// signs a certificate using SHA-256 instead of SHA-1</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">());</span>

<span class="c1">// verifies an issued certificate using the certificates public key</span>
<span class="kd">var</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">issuer</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">issued</span><span class="p">);</span>

<span class="c1">// generate a keypair and create an X.509v3 certificate</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">(</span><span class="mi">2048</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">createCertificate</span><span class="p">();</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">;</span>
<span class="c1">// alternatively set public key from a csr</span>
<span class="c1">//cert.publicKey = csr.publicKey;</span>
<span class="c1">// NOTE: serialNumber is the hex encoded value of an ASN.1 INTEGER.</span>
<span class="c1">// Conforming CAs should ensure serialNumber is:</span>
<span class="c1">// - no more than 20 octets</span>
<span class="c1">// - non-negative (prefix a &#39;00&#39; if your value starts with a &#39;1&#39; bit)</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">serialNumber</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span><span class="p">;</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span><span class="p">.</span><span class="nx">setFullYear</span><span class="p">(</span><span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="p">[{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;commonName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;example.org&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;countryName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;US&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">shortName</span><span class="o">:</span> <span class="s1">&#39;ST&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Virginia&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;localityName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Blacksburg&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;organizationName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Test&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">shortName</span><span class="o">:</span> <span class="s1">&#39;OU&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Test&#39;</span>
<span class="p">}];</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">setSubject</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
<span class="c1">// alternatively set subject from a csr</span>
<span class="c1">//cert.setSubject(csr.subject.attributes);</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">setIssuer</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">setExtensions</span><span class="p">([{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;basicConstraints&#39;</span><span class="p">,</span>
  <span class="nx">cA</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;keyUsage&#39;</span><span class="p">,</span>
  <span class="nx">keyCertSign</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">digitalSignature</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">nonRepudiation</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">keyEncipherment</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">dataEncipherment</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;extKeyUsage&#39;</span><span class="p">,</span>
  <span class="nx">serverAuth</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">clientAuth</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">codeSigning</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">emailProtection</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">timeStamping</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;nsCertType&#39;</span><span class="p">,</span>
  <span class="nx">client</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">server</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">objsign</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">sslCA</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">emailCA</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">objCA</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;subjectAltName&#39;</span><span class="p">,</span>
  <span class="nx">altNames</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="c1">// URI</span>
    <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;http://example.org/webid#me&#39;</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span> <span class="c1">// IP</span>
    <span class="nx">ip</span><span class="o">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
  <span class="p">}]</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;subjectKeyIdentifier&#39;</span>
<span class="p">}]);</span>
<span class="cm">/* alternatively set extensions from a csr</span>
<span class="cm">var extensions = csr.getAttribute({name: &#39;extensionRequest&#39;}).extensions;</span>
<span class="cm">// optionally add more extensions</span>
<span class="cm">extensions.push.apply(extensions, [{</span>
<span class="cm">  name: &#39;basicConstraints&#39;,</span>
<span class="cm">  cA: true</span>
<span class="cm">}, {</span>
<span class="cm">  name: &#39;keyUsage&#39;,</span>
<span class="cm">  keyCertSign: true,</span>
<span class="cm">  digitalSignature: true,</span>
<span class="cm">  nonRepudiation: true,</span>
<span class="cm">  keyEncipherment: true,</span>
<span class="cm">  dataEncipherment: true</span>
<span class="cm">}]);</span>
<span class="cm">cert.setExtensions(extensions);</span>
<span class="cm">*/</span>
<span class="c1">// self-sign certificate</span>
<span class="nx">cert</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">);</span>

<span class="c1">// convert a Forge certificate to PEM</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">certificateToPem</span><span class="p">(</span><span class="nx">cert</span><span class="p">);</span>

<span class="c1">// convert a Forge certificate from PEM</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">certificateFromPem</span><span class="p">(</span><span class="nx">pem</span><span class="p">);</span>

<span class="c1">// convert an ASN.1 X.509x3 object to a Forge certificate</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">certificateFromAsn1</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>

<span class="c1">// convert a Forge certificate to an ASN.1 X.509v3 object</span>
<span class="kd">var</span> <span class="nx">asn1Cert</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">certificateToAsn1</span><span class="p">(</span><span class="nx">cert</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><a name="pkcs5" /></p>
<h3 id="pkcs5">PKCS#5</h3>
<p>Provides the password-based key-derivation function from <a href="http://en.wikipedia.org/wiki/PKCS">PKCS#5</a>.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// generate a password-based 16-byte key</span>
<span class="c1">// note an optional message digest can be passed as the final parameter</span>
<span class="kd">var</span> <span class="nx">salt</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">derivedKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs5</span><span class="p">.</span><span class="nx">pbkdf2</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="nx">numIterations</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

<span class="c1">// generate key asynchronously</span>
<span class="c1">// note an optional message digest can be passed before the callback</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs5</span><span class="p">.</span><span class="nx">pbkdf2</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="nx">numIterations</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">derivedKey</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// do something w/derivedKey</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p><a name="pkcs7" /></p>
<h3 id="pkcs7">PKCS#7</h3>
<p>Provides cryptographically protected messages from <a href="http://en.wikipedia.org/wiki/Cryptographic_Message_Syntax">PKCS#7</a>.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// convert a message from PEM</span>
<span class="kd">var</span> <span class="nx">p7</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">messageFromPem</span><span class="p">(</span><span class="nx">pem</span><span class="p">);</span>
<span class="c1">// look at p7.recipients</span>

<span class="c1">// find a recipient by the issuer of a certificate</span>
<span class="kd">var</span> <span class="nx">recipient</span> <span class="o">=</span> <span class="nx">p7</span><span class="p">.</span><span class="nx">findRecipient</span><span class="p">(</span><span class="nx">cert</span><span class="p">);</span>

<span class="c1">// decrypt</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">p7</span><span class="p">.</span><span class="nx">recipients</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">privateKey</span><span class="p">);</span>

<span class="c1">// create a p7 enveloped message</span>
<span class="kd">var</span> <span class="nx">p7</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">createEnvelopedData</span><span class="p">();</span>

<span class="c1">// add a recipient</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">certificateFromPem</span><span class="p">(</span><span class="nx">certPem</span><span class="p">);</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">addRecipient</span><span class="p">(</span><span class="nx">cert</span><span class="p">);</span>

<span class="c1">// set content</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>

<span class="c1">// encrypt</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">();</span>

<span class="c1">// convert message to PEM</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">messageToPem</span><span class="p">(</span><span class="nx">p7</span><span class="p">);</span>

<span class="c1">// create a degenerate PKCS#7 certificate container</span>
<span class="c1">// (CRLs not currently supported, only certificates)</span>
<span class="kd">var</span> <span class="nx">p7</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">createSignedData</span><span class="p">();</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">addCertificate</span><span class="p">(</span><span class="nx">certOrCertPem1</span><span class="p">);</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">addCertificate</span><span class="p">(</span><span class="nx">certOrCertPem2</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">messageToPem</span><span class="p">(</span><span class="nx">p7</span><span class="p">);</span>

<span class="c1">// create PKCS#7 signed data with authenticatedAttributes</span>
<span class="c1">// attributes include: PKCS#9 content-type, message-digest, and signing-time</span>
<span class="kd">var</span> <span class="nx">p7</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">createSignedData</span><span class="p">();</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="s1">&#39;Some content to be signed.&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">addCertificate</span><span class="p">(</span><span class="nx">certOrCertPem</span><span class="p">);</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">addSigner</span><span class="p">({</span>
  <span class="nx">key</span><span class="o">:</span> <span class="nx">privateKeyAssociatedWithCert</span><span class="p">,</span>
  <span class="nx">certificate</span><span class="o">:</span> <span class="nx">certOrCertPem</span><span class="p">,</span>
  <span class="nx">digestAlgorithm</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">sha256</span><span class="p">,</span>
  <span class="nx">authenticatedAttributes</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">contentType</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">data</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">messageDigest</span>
    <span class="c1">// value will be auto-populated at signing time</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">signingTime</span><span class="p">,</span>
    <span class="c1">// value can also be auto-populated at signing time</span>
    <span class="nx">value</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
  <span class="p">}]</span>
<span class="p">});</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">sign</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs7</span><span class="p">.</span><span class="nx">messageToPem</span><span class="p">(</span><span class="nx">p7</span><span class="p">);</span>

<span class="c1">// PKCS#7 Sign in detached mode.</span>
<span class="c1">// Includes the signature and certificate without the signed data.</span>
<span class="nx">p7</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span><span class="nx">detached</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</pre></div>
</td></tr></table>

<p><a name="pkcs8" /></p>
<h3 id="pkcs8">PKCS#8</h3>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">pki</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">;</span>

<span class="c1">// convert a PEM-formatted private key to a Forge private key</span>
<span class="kd">var</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">privateKeyFromPem</span><span class="p">(</span><span class="nx">pem</span><span class="p">);</span>

<span class="c1">// convert a Forge private key to PEM-format</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">privateKeyToPem</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">);</span>

<span class="c1">// convert an ASN.1 PrivateKeyInfo or RSAPrivateKey to a Forge private key</span>
<span class="kd">var</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">privateKeyFromAsn1</span><span class="p">(</span><span class="nx">rsaPrivateKey</span><span class="p">);</span>

<span class="c1">// convert a Forge private key to an ASN.1 RSAPrivateKey</span>
<span class="kd">var</span> <span class="nx">rsaPrivateKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">privateKeyToAsn1</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">);</span>

<span class="c1">// wrap an RSAPrivateKey ASN.1 object in a PKCS#8 ASN.1 PrivateKeyInfo</span>
<span class="kd">var</span> <span class="nx">privateKeyInfo</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">wrapRsaPrivateKey</span><span class="p">(</span><span class="nx">rsaPrivateKey</span><span class="p">);</span>

<span class="c1">// convert a PKCS#8 ASN.1 PrivateKeyInfo to PEM</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">privateKeyInfoToPem</span><span class="p">(</span><span class="nx">privateKeyInfo</span><span class="p">);</span>

<span class="c1">// encrypts a PrivateKeyInfo and outputs an EncryptedPrivateKeyInfo</span>
<span class="kd">var</span> <span class="nx">encryptedPrivateKeyInfo</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">encryptPrivateKeyInfo</span><span class="p">(</span>
  <span class="nx">privateKeyInfo</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">algorithm</span><span class="o">:</span> <span class="s1">&#39;aes256&#39;</span><span class="p">,</span> <span class="c1">// &#39;aes128&#39;, &#39;aes192&#39;, &#39;aes256&#39;, &#39;3des&#39;</span>
  <span class="p">});</span>

<span class="c1">// decrypts an ASN.1 EncryptedPrivateKeyInfo</span>
<span class="kd">var</span> <span class="nx">privateKeyInfo</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">decryptPrivateKeyInfo</span><span class="p">(</span>
  <span class="nx">encryptedPrivateKeyInfo</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="c1">// converts an EncryptedPrivateKeyInfo to PEM</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">encryptedPrivateKeyToPem</span><span class="p">(</span><span class="nx">encryptedPrivateKeyInfo</span><span class="p">);</span>

<span class="c1">// converts a PEM-encoded EncryptedPrivateKeyInfo to ASN.1 format</span>
<span class="kd">var</span> <span class="nx">encryptedPrivateKeyInfo</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">encryptedPrivateKeyFromPem</span><span class="p">(</span><span class="nx">pem</span><span class="p">);</span>

<span class="c1">// wraps and encrypts a Forge private key and outputs it in PEM format</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">encryptRsaPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="c1">// encrypts a Forge private key and outputs it in PEM format using OpenSSL&#39;s</span>
<span class="c1">// proprietary legacy format + encapsulated PEM headers (DEK-Info)</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">encryptRsaPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">legacy</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>

<span class="c1">// decrypts a PEM-formatted, encrypted private key</span>
<span class="kd">var</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">decryptRsaPrivateKey</span><span class="p">(</span><span class="nx">pem</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="c1">// sets an RSA public key from a private key</span>
<span class="kd">var</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">setRsaPublicKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">.</span><span class="nx">n</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">.</span><span class="nx">e</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p><a name="pkcs10" /></p>
<h3 id="pkcs10">PKCS#10</h3>
<p>Provides certification requests or certificate signing requests (CSR) from
<a href="http://en.wikipedia.org/wiki/Certificate_signing_request">PKCS#10</a>.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// generate a key pair</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nx">generateKeyPair</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>

<span class="c1">// create a certification request (CSR)</span>
<span class="kd">var</span> <span class="nx">csr</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">createCertificationRequest</span><span class="p">();</span>
<span class="nx">csr</span><span class="p">.</span><span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">;</span>
<span class="nx">csr</span><span class="p">.</span><span class="nx">setSubject</span><span class="p">([{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;commonName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;example.org&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;countryName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;US&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">shortName</span><span class="o">:</span> <span class="s1">&#39;ST&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Virginia&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;localityName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Blacksburg&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;organizationName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Test&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">shortName</span><span class="o">:</span> <span class="s1">&#39;OU&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Test&#39;</span>
<span class="p">}]);</span>
<span class="c1">// set (optional) attributes</span>
<span class="nx">csr</span><span class="p">.</span><span class="nx">setAttributes</span><span class="p">([{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;challengePassword&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;unstructuredName&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;My Company, Inc.&#39;</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;extensionRequest&#39;</span><span class="p">,</span>
  <span class="nx">extensions</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;subjectAltName&#39;</span><span class="p">,</span>
    <span class="nx">altNames</span><span class="o">:</span> <span class="p">[{</span>
      <span class="c1">// 2 is DNS type</span>
      <span class="nx">type</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;test.domain.com&#39;</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;other.domain.com&#39;</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;www.domain.net&#39;</span>
    <span class="p">}]</span>
  <span class="p">}]</span>
<span class="p">}]);</span>

<span class="c1">// sign certification request</span>
<span class="nx">csr</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">);</span>

<span class="c1">// verify certification request</span>
<span class="kd">var</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">csr</span><span class="p">.</span><span class="nx">verify</span><span class="p">();</span>

<span class="c1">// convert certification request to PEM-format</span>
<span class="kd">var</span> <span class="nx">pem</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">certificationRequestToPem</span><span class="p">(</span><span class="nx">csr</span><span class="p">);</span>

<span class="c1">// convert a Forge certification request from PEM-format</span>
<span class="kd">var</span> <span class="nx">csr</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">certificationRequestFromPem</span><span class="p">(</span><span class="nx">pem</span><span class="p">);</span>

<span class="c1">// get an attribute</span>
<span class="nx">csr</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;challengePassword&#39;</span><span class="p">});</span>

<span class="c1">// get extensions array</span>
<span class="nx">csr</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;extensionRequest&#39;</span><span class="p">}).</span><span class="nx">extensions</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p><a name="pkcs12" /></p>
<h3 id="pkcs12">PKCS#12</h3>
<p>Provides the cryptographic archive file format from <a href="http://en.wikipedia.org/wiki/PKCS_%E2%99%AF12">PKCS#12</a>.</p>
<p><strong>Note for Chrome/Firefox/iOS/similar users</strong>: If you have trouble importing
a PKCS#12 container, try using the TripleDES algorithm. It can be passed
to <code>forge.pkcs12.toPkcs12Asn1</code> using the <code>{algorithm: '3des'}</code> option.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// decode p12 from base64</span>
<span class="kd">var</span> <span class="nx">p12Der</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decode64</span><span class="p">(</span><span class="nx">p12b64</span><span class="p">);</span>
<span class="c1">// get p12 as ASN.1 object</span>
<span class="kd">var</span> <span class="nx">p12Asn1</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">fromDer</span><span class="p">(</span><span class="nx">p12Der</span><span class="p">);</span>
<span class="c1">// decrypt p12 using the password &#39;password&#39;</span>
<span class="kd">var</span> <span class="nx">p12</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs12</span><span class="p">.</span><span class="nx">pkcs12FromAsn1</span><span class="p">(</span><span class="nx">p12Asn1</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="c1">// decrypt p12 using non-strict parsing mode (resolves some ASN.1 parse errors)</span>
<span class="kd">var</span> <span class="nx">p12</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs12</span><span class="p">.</span><span class="nx">pkcs12FromAsn1</span><span class="p">(</span><span class="nx">p12Asn1</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
<span class="c1">// decrypt p12 using literally no password (eg: Mac OS X/apple push)</span>
<span class="kd">var</span> <span class="nx">p12</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs12</span><span class="p">.</span><span class="nx">pkcs12FromAsn1</span><span class="p">(</span><span class="nx">p12Asn1</span><span class="p">);</span>
<span class="c1">// decrypt p12 using an &quot;empty&quot; password (eg: OpenSSL with no password input)</span>
<span class="kd">var</span> <span class="nx">p12</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs12</span><span class="p">.</span><span class="nx">pkcs12FromAsn1</span><span class="p">(</span><span class="nx">p12Asn1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="c1">// p12.safeContents is an array of safe contents, each of</span>
<span class="c1">// which contains an array of safeBags</span>

<span class="c1">// get bags by friendlyName</span>
<span class="kd">var</span> <span class="nx">bags</span> <span class="o">=</span> <span class="nx">p12</span><span class="p">.</span><span class="nx">getBags</span><span class="p">({</span><span class="nx">friendlyName</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">});</span>
<span class="c1">// bags are key&#39;d by attribute type (here &quot;friendlyName&quot;)</span>
<span class="c1">// and the key values are an array of matching objects</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">bags</span><span class="p">.</span><span class="nx">friendlyName</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">// get bags by localKeyId</span>
<span class="kd">var</span> <span class="nx">bags</span> <span class="o">=</span> <span class="nx">p12</span><span class="p">.</span><span class="nx">getBags</span><span class="p">({</span><span class="nx">localKeyId</span><span class="o">:</span> <span class="nx">buffer</span><span class="p">});</span>
<span class="c1">// bags are key&#39;d by attribute type (here &quot;localKeyId&quot;)</span>
<span class="c1">// and the key values are an array of matching objects</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">bags</span><span class="p">.</span><span class="nx">localKeyId</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">// get bags by localKeyId (input in hex)</span>
<span class="kd">var</span> <span class="nx">bags</span> <span class="o">=</span> <span class="nx">p12</span><span class="p">.</span><span class="nx">getBags</span><span class="p">({</span><span class="nx">localKeyIdHex</span><span class="o">:</span> <span class="s1">&#39;7b59377ff142d0be4565e9ac3d396c01401cd879&#39;</span><span class="p">});</span>
<span class="c1">// bags are key&#39;d by attribute type (here &quot;localKeyId&quot;, *not* &quot;localKeyIdHex&quot;)</span>
<span class="c1">// and the key values are an array of matching objects</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">bags</span><span class="p">.</span><span class="nx">localKeyId</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">// get bags by type</span>
<span class="kd">var</span> <span class="nx">bags</span> <span class="o">=</span> <span class="nx">p12</span><span class="p">.</span><span class="nx">getBags</span><span class="p">({</span><span class="nx">bagType</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">certBag</span><span class="p">});</span>
<span class="c1">// bags are key&#39;d by bagType and each bagType key&#39;s value</span>
<span class="c1">// is an array of matches (in this case, certificate objects)</span>
<span class="kd">var</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">bags</span><span class="p">[</span><span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">certBag</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">// get bags by friendlyName and filter on bag type</span>
<span class="kd">var</span> <span class="nx">bags</span> <span class="o">=</span> <span class="nx">p12</span><span class="p">.</span><span class="nx">getBags</span><span class="p">({</span>
  <span class="nx">friendlyName</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
  <span class="nx">bagType</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">certBag</span>
<span class="p">});</span>

<span class="c1">// get key bags</span>
<span class="kd">var</span> <span class="nx">bags</span> <span class="o">=</span> <span class="nx">p12</span><span class="p">.</span><span class="nx">getBags</span><span class="p">({</span><span class="nx">bagType</span><span class="o">:</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">keyBag</span><span class="p">});</span>
<span class="c1">// get key</span>
<span class="kd">var</span> <span class="nx">bag</span> <span class="o">=</span> <span class="nx">bags</span><span class="p">[</span><span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">.</span><span class="nx">keyBag</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">bag</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
<span class="c1">// if the key is in a format unrecognized by forge then</span>
<span class="c1">// bag.key will be `null`, use bag.asn1 to get the ASN.1</span>
<span class="c1">// representation of the key</span>
<span class="k">if</span><span class="p">(</span><span class="nx">bag</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">keyAsn1</span> <span class="o">=</span> <span class="nx">bag</span><span class="p">.</span><span class="nx">asn1</span><span class="p">;</span>
  <span class="c1">// can now convert back to DER/PEM/etc for export</span>
<span class="p">}</span>

<span class="c1">// generate a p12 using AES (default)</span>
<span class="kd">var</span> <span class="nx">p12Asn1</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs12</span><span class="p">.</span><span class="nx">toPkcs12Asn1</span><span class="p">(</span>
  <span class="nx">privateKey</span><span class="p">,</span> <span class="nx">certificateChain</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="c1">// generate a p12 that can be imported by Chrome/Firefox/iOS</span>
<span class="c1">// (requires the use of Triple DES instead of AES)</span>
<span class="kd">var</span> <span class="nx">p12Asn1</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pkcs12</span><span class="p">.</span><span class="nx">toPkcs12Asn1</span><span class="p">(</span>
  <span class="nx">privateKey</span><span class="p">,</span> <span class="nx">certificateChain</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">algorithm</span><span class="o">:</span> <span class="s1">&#39;3des&#39;</span><span class="p">});</span>

<span class="c1">// base64-encode p12</span>
<span class="kd">var</span> <span class="nx">p12Der</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">toDer</span><span class="p">(</span><span class="nx">p12Asn1</span><span class="p">).</span><span class="nx">getBytes</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">p12b64</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">encode64</span><span class="p">(</span><span class="nx">p12Der</span><span class="p">);</span>

<span class="c1">// create download link for p12</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="s1">&#39;example.p12&#39;</span><span class="p">;</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;data:application/x-pkcs12;base64,&#39;</span> <span class="o">+</span> <span class="nx">p12b64</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Download&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table>

<p><a name="asn" /></p>
<h3 id="asn1">ASN.1</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/ASN.1">ASN.1</a> DER encoding and decoding.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">asn1</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">asn1</span><span class="p">;</span>

<span class="c1">// create a SubjectPublicKeyInfo</span>
<span class="kd">var</span> <span class="nx">subjectPublicKeyInfo</span> <span class="o">=</span>
  <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">SEQUENCE</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1">// AlgorithmIdentifier</span>
    <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">SEQUENCE</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="p">[</span>
      <span class="c1">// algorithm</span>
      <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">OID</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">asn1</span><span class="p">.</span><span class="nx">oidToDer</span><span class="p">(</span><span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">[</span><span class="s1">&#39;rsaEncryption&#39;</span><span class="p">]).</span><span class="nx">getBytes</span><span class="p">()),</span>
      <span class="c1">// parameters (null)</span>
      <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">NULL</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">]),</span>
    <span class="c1">// subjectPublicKey</span>
    <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">BITSTRING</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="p">[</span>
      <span class="c1">// RSAPublicKey</span>
      <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">SEQUENCE</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1">// modulus (n)</span>
        <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span>
          <span class="nx">_bnToBytes</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">n</span><span class="p">)),</span>
        <span class="c1">// publicExponent (e)</span>
        <span class="nx">asn1</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span>
          <span class="nx">_bnToBytes</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">e</span><span class="p">))</span>
      <span class="p">])</span>
    <span class="p">])</span>
  <span class="p">]);</span>

<span class="c1">// serialize an ASN.1 object to DER format</span>
<span class="kd">var</span> <span class="nx">derBuffer</span> <span class="o">=</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">toDer</span><span class="p">(</span><span class="nx">subjectPublicKeyInfo</span><span class="p">);</span>

<span class="c1">// deserialize to an ASN.1 object from a byte buffer filled with DER data</span>
<span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">fromDer</span><span class="p">(</span><span class="nx">derBuffer</span><span class="p">);</span>

<span class="c1">// convert an OID dot-separated string to a byte buffer</span>
<span class="kd">var</span> <span class="nx">derOidBuffer</span> <span class="o">=</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">oidToDer</span><span class="p">(</span><span class="s1">&#39;1.2.840.113549.1.1.5&#39;</span><span class="p">);</span>

<span class="c1">// convert a byte buffer with a DER-encoded OID to a dot-separated string</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">derToOid</span><span class="p">(</span><span class="nx">derOidBuffer</span><span class="p">));</span>
<span class="c1">// output: 1.2.840.113549.1.1.5</span>

<span class="c1">// validates that an ASN.1 object matches a particular ASN.1 structure and</span>
<span class="c1">// captures data of interest from that structure for easy access</span>
<span class="kd">var</span> <span class="nx">publicKeyValidator</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;SubjectPublicKeyInfo&#39;</span><span class="p">,</span>
  <span class="nx">tagClass</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">SEQUENCE</span><span class="p">,</span>
  <span class="nx">constructed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">captureAsn1</span><span class="o">:</span> <span class="s1">&#39;subjectPublicKeyInfo&#39;</span><span class="p">,</span>
  <span class="nx">value</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;SubjectPublicKeyInfo.AlgorithmIdentifier&#39;</span><span class="p">,</span>
    <span class="nx">tagClass</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">SEQUENCE</span><span class="p">,</span>
    <span class="nx">constructed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="p">[{</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;AlgorithmIdentifier.algorithm&#39;</span><span class="p">,</span>
      <span class="nx">tagClass</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">OID</span><span class="p">,</span>
      <span class="nx">constructed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">capture</span><span class="o">:</span> <span class="s1">&#39;publicKeyOid&#39;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="c1">// subjectPublicKey</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;SubjectPublicKeyInfo.subjectPublicKey&#39;</span><span class="p">,</span>
    <span class="nx">tagClass</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">BITSTRING</span><span class="p">,</span>
    <span class="nx">constructed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="p">[{</span>
      <span class="c1">// RSAPublicKey</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey&#39;</span><span class="p">,</span>
      <span class="nx">tagClass</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">UNIVERSAL</span><span class="p">,</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">Type</span><span class="p">.</span><span class="nx">SEQUENCE</span><span class="p">,</span>
      <span class="nx">constructed</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">optional</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">captureAsn1</span><span class="o">:</span> <span class="s1">&#39;rsaPublicKey&#39;</span>
    <span class="p">}]</span>
  <span class="p">}]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">capture</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">asn1</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span>
  <span class="nx">publicKeyValidator</span><span class="p">,</span> <span class="nx">subjectPublicKeyInfo</span><span class="p">,</span> <span class="nx">validator</span><span class="p">,</span> <span class="nx">capture</span><span class="p">,</span> <span class="nx">errors</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="s1">&#39;ASN.1 object is not a SubjectPublicKeyInfo.&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// capture.subjectPublicKeyInfo contains the full ASN.1 object</span>
<span class="c1">// capture.rsaPublicKey contains the full ASN.1 object for the RSA public key</span>
<span class="c1">// capture.publicKeyOid only contains the value for the OID</span>
<span class="kd">var</span> <span class="nx">oid</span> <span class="o">=</span> <span class="nx">asn1</span><span class="p">.</span><span class="nx">derToOid</span><span class="p">(</span><span class="nx">capture</span><span class="p">.</span><span class="nx">publicKeyOid</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">oid</span> <span class="o">!==</span> <span class="nx">pki</span><span class="p">.</span><span class="nx">oids</span><span class="p">[</span><span class="s1">&#39;rsaEncryption&#39;</span><span class="p">])</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="s1">&#39;Unsupported OID.&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// pretty print an ASN.1 object to a string for debugging purposes</span>
<span class="nx">asn1</span><span class="p">.</span><span class="nx">prettyPrint</span><span class="p">(</span><span class="nx">object</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h2 id="message-digests_1">Message Digests</h2>
<p><a name="sha1" /></p>
<h3 id="sha1">SHA1</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/SHA-1">SHA-1</a> message digests.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha1</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: 2fd4e1c67a2d28fced849ee1bb76e7391b93eb12</span>
</pre></div>
</td></tr></table>

<p><a name="sha256" /></p>
<h3 id="sha256">SHA256</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/SHA-256">SHA-256</a> message digests.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: d7a8fbb307d7809469ca9abcb0082e4f8d5651e46d3cdb762d02d0bf37c9e592</span>
</pre></div>
</td></tr></table>

<p><a name="sha384" /></p>
<h3 id="sha384">SHA384</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/SHA-384">SHA-384</a> message digests.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha384</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: ca737f1014a48f4c0b6dd43cb177b0afd9e5169367544c494011e3317dbf9a509cb1e5dc1e85a941bbee3d7f2afbc9b1</span>
</pre></div>
</td></tr></table>

<p><a name="sha512" /></p>
<h3 id="sha512">SHA512</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/SHA-512">SHA-512</a> message digests.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// SHA-512</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: 07e547d9586f6a73f73fbac0435ed76951218fb7d0c8d788a309d785436bbb642e93a252a954f23912547d1e8a3b5ed6e1bfd7097821233fa0538f3db854fee6</span>

<span class="c1">// SHA-512/224</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nx">sha224</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: 944cd2847fb54558d4775db0485a50003111c8e5daa63fe722c6aa37</span>

<span class="c1">// SHA-512/256</span>
<span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: dd9d67b371519c339ed8dbd25af90e976a1eeefd4ad3d889005e532fc5bef04d</span>
</pre></div>
</td></tr></table>

<p><a name="md5" /></p>
<h3 id="md5">MD5</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/MD5">MD5</a> message digests.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">md</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">md5</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumps over the lazy dog&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">md</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: 9e107d9d372bb6826bd81d3542a419d6</span>
</pre></div>
</td></tr></table>

<p><a name="hmac" /></p>
<h3 id="hmac">HMAC</h3>
<p>Provides <a href="http://en.wikipedia.org/wiki/HMAC">HMAC</a> w/any supported message digest algorithm.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">hmac</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">hmac</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="s1">&#39;Jefe&#39;</span><span class="p">);</span>
<span class="nx">hmac</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;what do ya want for nothing?&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hmac</span><span class="p">.</span><span class="nx">digest</span><span class="p">().</span><span class="nx">toHex</span><span class="p">());</span>
<span class="c1">// output: effcdf6ae5eb2fa2d27416d5f184df9c259a7c79</span>
</pre></div>
</td></tr></table>

<h2 id="utilities_1">Utilities</h2>
<p><a name="prime" /></p>
<h3 id="prime">Prime</h3>
<p>Provides an API for generating large, random, probable primes.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// generate a random prime on the main JS thread</span>
<span class="kd">var</span> <span class="nx">bits</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">prime</span><span class="p">.</span><span class="nx">generateProbablePrime</span><span class="p">(</span><span class="nx">bits</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;random prime&#39;</span><span class="p">,</span> <span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
<span class="p">});</span>

<span class="c1">// generate a random prime using Web Workers (if available, otherwise</span>
<span class="c1">// falls back to the main thread)</span>
<span class="kd">var</span> <span class="nx">bits</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">algorithm</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;PRIMEINC&#39;</span><span class="p">,</span>
    <span class="nx">workers</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">// auto-optimize # of workers</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">prime</span><span class="p">.</span><span class="nx">generateProbablePrime</span><span class="p">(</span><span class="nx">bits</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;random prime&#39;</span><span class="p">,</span> <span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p><a name="prng" /></p>
<h3 id="prng">PRNG</h3>
<p>Provides a <a href="http://en.wikipedia.org/wiki/Fortuna_(PRNG)">Fortuna</a>-based cryptographically-secure pseudo-random number
generator, to be used with a cryptographic function backend, e.g. <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>. An
implementation using <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> as a backend is provided. An API for collecting
entropy is given, though if window.crypto.getRandomValues is available, it will
be used automatically.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// get some random bytes synchronously</span>
<span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytesSync</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">bytesToHex</span><span class="p">(</span><span class="nx">bytes</span><span class="p">));</span>

<span class="c1">// get some random bytes asynchronously</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">bytesToHex</span><span class="p">(</span><span class="nx">bytes</span><span class="p">));</span>
<span class="p">});</span>

<span class="c1">// collect some entropy if you&#39;d like</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">collect</span><span class="p">(</span><span class="nx">someRandomBytes</span><span class="p">);</span>
<span class="nx">jQuery</span><span class="p">().</span><span class="nx">mousemove</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">collectInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
  <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">collectInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// specify a seed file for use with the synchronous API if you&#39;d like</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">seedFileSync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">needed</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// get &#39;needed&#39; number of random bytes from somewhere</span>
  <span class="k">return</span> <span class="nx">fetchedRandomBytes</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// specify a seed file for use with the asynchronous API if you&#39;d like</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">seedFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">needed</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// get the &#39;needed&#39; number of random bytes from somewhere</span>
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">fetchedRandomBytes</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// register the main thread to send entropy or a Web Worker to receive</span>
<span class="c1">// entropy on demand from the main thread</span>
<span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">registerWorker</span><span class="p">(</span><span class="nx">self</span><span class="p">);</span>

<span class="c1">// generate a new instance of a PRNG with no collected entropy</span>
<span class="kd">var</span> <span class="nx">myPrng</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nx">createInstance</span><span class="p">();</span>
</pre></div>
</td></tr></table>

<p><a name="task" /></p>
<h3 id="tasks">Tasks</h3>
<p>Provides queuing and synchronizing tasks in a web application.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TODO</span>
</pre></div>
</td></tr></table>

<p><a name="util" /></p>
<h3 id="utilities_2">Utilities</h3>
<p>Provides utility functions, including byte buffer support, base64,
bytes to/from hex, zlib inflate/deflate, etc.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// encode/decode base64</span>
<span class="kd">var</span> <span class="nx">encoded</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">encode64</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decode64</span><span class="p">(</span><span class="nx">encoded</span><span class="p">);</span>

<span class="c1">// encode/decode UTF-8</span>
<span class="kd">var</span> <span class="nx">encoded</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">encodeUtf8</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">decodeUtf8</span><span class="p">(</span><span class="nx">encoded</span><span class="p">);</span>

<span class="c1">// bytes to/from hex</span>
<span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">hexToBytes</span><span class="p">(</span><span class="nx">hex</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">hex</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">bytesToHex</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>

<span class="c1">// create an empty byte buffer</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
<span class="c1">// create a byte buffer from raw binary bytes</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s1">&#39;raw&#39;</span><span class="p">);</span>
<span class="c1">// create a byte buffer from utf8 bytes</span>
<span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>

<span class="c1">// get the length of the buffer in bytes</span>
<span class="nx">buffer</span><span class="p">.</span><span class="nx">length</span><span class="p">();</span>
<span class="c1">// put bytes into the buffer</span>
<span class="nx">buffer</span><span class="p">.</span><span class="nx">putBytes</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
<span class="c1">// put a 32-bit integer into the buffer</span>
<span class="nx">buffer</span><span class="p">.</span><span class="nx">putInt32</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">// buffer to hex</span>
<span class="nx">buffer</span><span class="p">.</span><span class="nx">toHex</span><span class="p">();</span>
<span class="c1">// get a copy of the bytes in the buffer</span>
<span class="nx">bytes</span><span class="p">.</span><span class="nx">bytes</span><span class="p">(</span><span class="cm">/* count */</span><span class="p">);</span>
<span class="c1">// empty this buffer and get its contents</span>
<span class="nx">bytes</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(</span><span class="cm">/* count */</span><span class="p">);</span>

<span class="c1">// convert a forge buffer into a Node.js Buffer</span>
<span class="c1">// make sure you specify the encoding as &#39;binary&#39;</span>
<span class="kd">var</span> <span class="nx">forgeBuffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">nodeBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">forgeBuffer</span><span class="p">.</span><span class="nx">getBytes</span><span class="p">(),</span> <span class="s1">&#39;binary&#39;</span><span class="p">);</span>

<span class="c1">// convert a Node.js Buffer into a forge buffer</span>
<span class="c1">// make sure you specify the encoding as &#39;binary&#39;</span>
<span class="kd">var</span> <span class="nx">nodeBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">forgeBuffer</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">(</span><span class="nx">nodeBuffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">));</span>

<span class="c1">// parse a URL</span>
<span class="kd">var</span> <span class="nx">parsed</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">parseUrl</span><span class="p">(</span><span class="s1">&#39;http://example.com/foo?bar=baz&#39;</span><span class="p">);</span>
<span class="c1">// parsed.scheme, parsed.host, parsed.port, parsed.path, parsed.fullHost</span>
</pre></div>
</td></tr></table>

<p><a name="log" /></p>
<h3 id="logging">Logging</h3>
<p>Provides logging to a javascript console using various categories and
levels of verbosity.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TODO</span>
</pre></div>
</td></tr></table>

<p><a name="debug" /></p>
<h3 id="debugging">Debugging</h3>
<p>Provides storage of debugging information normally inaccessible in
closures for viewing/investigation.</p>
<p><strong>Examples</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// TODO</span>
</pre></div>
</td></tr></table>

<p><a name="flash" /></p>
<h3 id="flash-networking-support">Flash Networking Support</h3>
<p>The <a href="flash/">flash README</a> provides details on rebuilding the
optional Flash component used for networking. It also provides details on
Policy Server support.</p>
<h2 id="security-considerations">Security Considerations</h2>
<p>When using this code please keep the following in mind:</p>
<ul>
<li>Cryptography is hard. Please review and test this code before depending on it
  for critical functionality.</li>
<li>The nature of JavaScript is that execution of this code depends on trusting a
  very large set of JavaScript tools and systems. Consider runtime variations,
  runtime characteristics, runtime optimization, code optimization, code
  minimization, code obfuscation, bundling tools, possible bugs, the Forge code
  itself, and so on.</li>
<li>If using pre-built bundles from <a href="https://bower.io/">Bower</a> or similar be aware someone else
  ran the tools to create those files.</li>
<li>Use a secure transport channel such as <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> to load scripts and consider
  using additional security mechanisms such as <a href="https://www.w3.org/TR/SRI/">Subresource Integrity</a> script
  attributes.</li>
<li>Use "native" functionality where possible. This can be critical when dealing
  with performance and random number generation. Note that the JavaScript
  random number algorithms should perform well if given suitable entropy.</li>
<li>Understand possible attacks against cryptographic systems. For instance side
  channel and timing attacks may be possible due to the difficulty in
  implementing constant time algorithms in pure JavaScript.</li>
<li>Certain features in this library are less susceptible to attacks depending on
  usage. This primarily includes features that deal with data format
  manipulation or those that are not involved in communication.</li>
</ul>
<h2 id="library-background">Library Background</h2>
<ul>
<li>http://digitalbazaar.com/2010/07/20/javascript-tls-1/</li>
<li>http://digitalbazaar.com/2010/07/20/javascript-tls-2/</li>
</ul>
<h2 id="contact">Contact</h2>
<ul>
<li>Code: https://github.com/digitalbazaar/forge</li>
<li>Bugs: https://github.com/digitalbazaar/forge/issues</li>
<li>Email: support@digitalbazaar.com</li>
<li>IRC: <a href="https://webchat.freenode.net/?channels=#forgejs">#forgejs</a> on <a href="https://freenode.net/">freenode</a></li>
</ul>
<h2 id="donations">Donations</h2>
<p>Financial support is welcome and helps contribute to futher development:</p>
<ul>
<li>For <a href="https://www.paypal.com/">PayPal</a> please send to paypal@digitalbazaar.com.</li>
<li>Something else? Please contact support@digitalbazaar.com.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../../../../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
    
    
      
    
  </body>
</html>