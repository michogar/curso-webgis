



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Architecture - Curso WebGIS. Mapas libres con Leaflet y OpenLayers</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../../../../../#postcss-architecture" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../../../.." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Curso WebGIS. Mapas libres con Leaflet y OpenLayers
              </span>
              <span class="md-header-nav__topic">
                Architecture
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../../../.." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Curso WebGIS. Mapas libres con Leaflet y OpenLayers
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../1_creando_mapa/" title="1. Creando un mapa" class="md-nav__link">
      1. Creando un mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../2_capas_base/" title="2. El mapa sin datos. Añadir una capa base" class="md-nav__link">
      2. El mapa sin datos. Añadir una capa base
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../3_mis_datos/" title="3. Mas allá de la capa base, añadiendo mis propios datos" class="md-nav__link">
      3. Mas allá de la capa base, añadiendo mis propios datos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../4_wms_wmts/" title="4. Y si los datos son enormes" class="md-nav__link">
      4. Y si los datos son enormes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../5_interactuando_mapa/" title="5. Interactuando con el mapa" class="md-nav__link">
      5. Interactuando con el mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../6_osm_y_tilemill/" title="6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres" class="md-nav__link">
      6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../../../7_extra_1_osm_y_umap/" title="7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap" class="md-nav__link">
      7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postcss-architecture" title="PostCSS Architecture" class="md-nav__link">
    PostCSS Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow" title="Workflow" class="md-nav__link">
    Workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-structures" title="Core Structures" class="md-nav__link">
    Core Structures
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tokenizer-libtokenizees6" title="Tokenizer ( lib/tokenize.es6 )" class="md-nav__link">
    Tokenizer ( lib/tokenize.es6 )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parser-libparsees6-libparseres6" title="Parser ( lib/parse.es6, lib/parser.es6 )" class="md-nav__link">
    Parser ( lib/parse.es6, lib/parser.es6 )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processor-libprocessores6" title="Processor ( lib/processor.es6 )" class="md-nav__link">
    Processor ( lib/processor.es6 )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stringifier-libstringifyes6-libstringifieres6" title="Stringifier ( lib/stringify.es6, lib/stringifier.es6 )" class="md-nav__link">
    Stringifier ( lib/stringify.es6, lib/stringifier.es6 )
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-reference" title="API Reference" class="md-nav__link">
    API Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/xeoinquedos/curso-webgis/edit/master/docs/openlayers/ol-googlemaps/node_modules/postcss/docs/architecture.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Architecture</h1>
                
                <h2 id="postcss-architecture">PostCSS Architecture</h2>
<p>General overview of PostCSS architecture.
It can be useful for everyone who wish to contribute to core or develop better understanding of the tool.</p>
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#workflow">Workflow</a></li>
<li><a href="#core-structures">Core Structures</a><ul>
<li><a href="#tokenizer--libtokenizees6-">Tokenizer</a></li>
<li><a href="#parser--libparsees6-libparseres6-">Parser</a></li>
<li><a href="#processor--libprocessores6-">Processor</a></li>
<li><a href="#stringifier--libstringifyes6-libstringifieres6-">Stringifier</a></li>
</ul>
</li>
<li><a href="#api-reference">API</a></li>
</ul>
<h3 id="overview">Overview</h3>
<blockquote>
<p>This section describes ideas lying behind PostCSS</p>
</blockquote>
<p>Before diving deeper into development of PostCSS let's briefly describe what is PostCSS and what is not.</p>
<p><strong>PostCSS</strong></p>
<ul>
<li>
<p><em>is <strong>NOT</strong> a style preprocessor like <code>Sass</code> or <code>Less</code>.</em></p>
<p>It does not define custom syntax and semantic, it's not actually a language.
PostCSS works with CSS and can be easily integrated with tools described above. That being said any valid CSS can be processed by PostCSS.</p>
</li>
<li>
<p><em>is a tool for CSS syntax transformations</em></p>
<p>It allows you to define custom CSS like syntax that could be understandable and transformed by plugins. That being said PostCSS is not strictly about CSS spec but about syntax definition manner of CSS. In such way you can define custom syntax constructs like at-rule, that could be very helpful for tools build around PostCSS. PostCSS plays a role of framework for building outstanding tools for CSS manipulations.</p>
</li>
<li>
<p><em>is a big player in CSS ecosystem</em></p>
<p>Large amount of lovely tools like <code>Autoprefixer</code>, <code>Stylelint</code>, <code>CSSnano</code> were built on PostCSS ecosystem. There is big chance that you already use it implicitly, just check your <code>node_modules</code> :smiley:</p>
</li>
</ul>
<h3 id="workflow">Workflow</h3>
<p>This is high level overview of whole PostCSS workflow</p>
<p><img width="300" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/PostCSS_scheme.svg/512px-PostCSS_scheme.svg.png" alt="workflow"></p>
<p>As you can see from diagram above, PostCSS architecture is pretty straightforward but some parts of it could be misunderstood.</p>
<p>From diagram above you can see part called <em>Parser</em>, this construct will be described in details later on, just for now think about it as a structure that can understand your CSS like syntax and create object representation of it.</p>
<p>That being said, there are few ways to write parser</p>
<ul>
<li>
<p><em>Write a single file with string to AST transformation</em></p>
<p>This method is quite popular, for example, the <a href="https://github.com/reworkcss/css/blob/master/lib/parse/index.js">Rework analyzer</a> was written in this style. But with a large code base, the code becomes hard to read and pretty slow.</p>
</li>
<li>
<p><em>Split it into lexical analysis/parsing steps (source string → tokens → AST)</em></p>
<p>This is the way of how we do it in PostCSS and also the most popular one.
A lot of parsers like <a href="https://github.com/babel/babel/tree/master/packages/babylon"><code>Babylon</code> (parser behind Babel)</a>, <a href="https://github.com/csstree/csstree"><code>CSSTree</code></a> were written in such way.
The main reasons to separate tokenization from parsing steps are performance and abstracting complexity.</p>
</li>
</ul>
<p>Let think about why second way is better for our needs.</p>
<p>First of all because string to tokens step takes more time than parsing step. We operate on large source string and process it char by char, this is why it is very inefficient operation in terms of performance and we should perform it only once.</p>
<p>But from other side tokens to AST transformation is logically more complex so with such separation we could write very fast tokenizer (but from this comes sometimes hard to read code) and easy to read (but slow) parser.</p>
<p>Summing it up splitting in two steps improve performance and code readability.</p>
<p>So now lets look more closely on structures that play main role in PostCSS workflow.</p>
<h3 id="core-structures">Core Structures</h3>
<ul>
<li>
<h4 id="tokenizer-libtokenizees6">Tokenizer ( <a href="https://github.com/postcss/postcss/blob/master/lib/tokenize.es6">lib/tokenize.es6</a> )</h4>
<p>Tokenizer (aka Lexer) plays important role in syntax analysis.</p>
<p>It accepts CSS string and returns list of tokens.</p>
<p>Token is a simple structure that describes some part of syntax like <code>at-rule</code>, <code>comment</code> or <code>word</code>. It can also contain positional information for more descriptive errors.</p>
<p>For example if we consider following css</p>
<p><code>css
.className { color: #FFF; }</code></p>
<p>corresponding tokens representation from PostCSS will be
<code>js
[
    ["word", ".className", 1, 1, 1, 10]
    ["space", " "]
    ["{", "{", 1, 12]
    ["space", " "]
    ["word", "color", 1, 14, 1, 18]
    [":", ":", 1, 19]
    ["space", " "]
    ["word", "#FFF" , 1, 21, 1, 23]
    [";", ";", 1, 24]
    ["space", " "]
    ["}", "}", 1, 26]
]</code></p>
<p>As you can see from the example above single token represented as a list and also <code>space</code> token doesn't have positional information.</p>
<p>Lets look more closely on single token like <code>word</code>. As it was said each token represented as a list and follow such pattern.</p>
<p>```js
const token = [
     // represents token type
    'word',</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>// represents matched word
&#39;.className&#39;,

// This two numbers represent start position of token.
// It&#39;s optional value as we saw in example above,
// tokens like `space` don&#39;t have such information.

// Here the first number is line number and the second one is corresponding column.
1, 1,

// Next two numbers also optional and represent end position for multichar tokens like this one. Numbers follow same rule as was described above
1, 10
</pre></div>
</td></tr></table>

<p>];
```
   There are many patterns how tokenization could be done, PostCSS motto is performance and simplicity. Tokenization is complex computing operation and take large amount of syntax analysis time ( ~90% ), that why PostCSS' Tokenizer looks dirty but it was optimized for speed. Any high-level constructs like classes could dramatically slow down tokenizer.</p>
<p>PostCSS' Tokenizer use some sort of streaming/chaining API where you exposes <a href="https://github.com/postcss/postcss/blob/master/lib/tokenize.es6#L48-L308"><code>nextToken()</code></a> method to Parser. In this manner we provide clean interface for Parser and reduce memory usage by storing only few tokens and not whole list of tokens.</p>
</li>
<li>
<h4 id="parser-libparsees6-libparseres6">Parser ( <a href="https://github.com/postcss/postcss/blob/master/lib/parse.es6">lib/parse.es6</a>, <a href="https://github.com/postcss/postcss/blob/master/lib/parser.es6">lib/parser.es6</a> )</h4>
<p>Parser is main structure that responsible for <a href="https://en.wikipedia.org/wiki/Parsing">syntax analysis</a> of incoming CSS. Parser produces structure called <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree (AST)</a> that could then be transformed by plugins later on.</p>
<p>Parser works in common with Tokenizer and operates over tokens not source string, as it would be very inefficient operation.</p>
<p>It use mostly <code>nextToken</code> and <code>back</code> methods provided by Tokenizer for obtaining single or multiple tokens and than construct part of AST called <code>Node</code></p>
<p>There are multiple Node types that PostCSS could produce but all of them inherit from base Node <a href="https://github.com/postcss/postcss/blob/master/lib/node.es6#L34">class</a>.</p>
</li>
<li>
<h4 id="processor-libprocessores6">Processor ( <a href="https://github.com/postcss/postcss/blob/master/lib/processor.es6">lib/processor.es6</a> )</h4>
<p>Processor is a very plain structure that initializes plugins and run syntax transformations. Plugin is just a function registered with <a href="https://github.com/postcss/postcss/blob/master/lib/postcss.es6#L109">postcss.plugin</a> call.</p>
<p>It exposes quite few public API methods. Description of them could be found on <a href="http://api.postcss.org/Processor.html">api.postcss.org/Processor</a></p>
</li>
<li>
<h4 id="stringifier-libstringifyes6-libstringifieres6">Stringifier ( <a href="https://github.com/postcss/postcss/blob/master/lib/stringify.es6">lib/stringify.es6</a>, <a href="https://github.com/postcss/postcss/blob/master/lib/stringifier.es6">lib/stringifier.es6</a> )</h4>
<p>Stringifier is a base class that translates modified AST to pure CSS string. Stringifier traverse AST starting from provided Node and generate raw string representation of it calling corresponding methods.</p>
<p>The most essential method is <a href="https://github.com/postcss/postcss/blob/master/lib/stringifier.es6#L25-L27"><code>Stringifier.stringify</code></a>
that accepts initial Node and semicolon indicator.
You can learn more by checking <a href="https://github.com/postcss/postcss/blob/master/lib/stringifier.es6">stringifier.es6</a></p>
</li>
</ul>
<h3 id="api-reference">API Reference</h3>
<p>More descriptive API documentation could be found <a href="http://api.postcss.org/">here</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../../../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../../../../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../../../../../../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../../../.."}})</script>
      
    
    
      
    
  </body>
</html>