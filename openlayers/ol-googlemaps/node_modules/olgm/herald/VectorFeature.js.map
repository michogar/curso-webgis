{"version":3,"file":"VectorFeature.js","sources":["../../../src/olgm/herald/VectorFeature.js"],"sourcesContent":["/**\n * @module olgm/herald/VectorFeature\n */\nimport FeatureHerald from './Feature.js';\nimport Herald from './Herald.js';\n\n/**\n * @typedef {Object} Cache\n * @property {module:ol/Feature} feature\n * @property {module:olgm/herald/Feature} herald\n */\n\nclass VectorFeatureHerald extends Herald {\n  /**\n   * The VectorFeature Herald is responsible of sychronizing the features from\n   * an ol3 vector source. The existing features in addition of those that are\n   * added and removed are all managed. Each existing or added feature is bound\n   * to a `olgm.herald.Feature` object. It gets unbound when removed.\n   *\n   * @param {module:ol/PluggableMap} ol3map openlayers map\n   * @param {google.maps.Map} gmap google maps map\n   * @param {ol.source.Vector} source vector source\n   * @param {google.maps.Data} data google maps data object\n   * @param {module:olgm/gm/MapIcon~Options} mapIconOptions map icon options\n   */\n  constructor(ol3map, gmap, source, data, mapIconOptions) {\n    super(ol3map, gmap);\n\n    /**\n     * @type {Array<module:ol/Feature>}\n     * @private\n     */\n    this.features_ = [];\n\n    /**\n     * @type {Array<olgm.herald.VectorFeature.Cache>}\n     * @private\n     */\n    this.cache_ = [];\n\n    /**\n     * @type {!google.maps.Data}\n     * @private\n     */\n    this.data_ = data;\n\n    /**\n     * @type {ol.source.Vector}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {module:olgm/gm/MapIcon~Options}\n     * @private\n     */\n    this.mapIconOptions_ = mapIconOptions;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.visible_ = true;\n  }\n\n\n  /**\n   * @inheritDoc\n   */\n  activate() {\n    super.activate();\n\n    // watch existing features...\n    this.source_.getFeatures().forEach((feature) => this.watchFeature_(feature));\n\n    // event listeners\n    const keys = this.listenerKeys;\n    keys.push(this.source_.on('addfeature', (event) => this.handleAddFeature_(event)));\n    keys.push(this.source_.on('removefeature', (event) => this.handleRemoveFeature_(event)));\n  }\n\n\n  /**\n   * @inheritDoc\n   */\n  deactivate() {\n    // unwatch existing features...\n    this.source_.getFeatures().forEach((feature) => this.unwatchFeature_(feature));\n\n    super.deactivate();\n  }\n\n\n  /**\n   * Set each feature visible or invisible\n   * @param {boolean} value true for visible, false for invisible\n   */\n  setVisible(value) {\n    this.visible_ = value;\n    for (let i = 0; i < this.cache_.length; i++) {\n      this.cache_[i].herald.setVisible(value);\n    }\n  }\n\n\n  /**\n   * @param {ol.source.Vector.Event} event addFeature event\n   * @private\n   */\n  handleAddFeature_(event) {\n    const feature = /** @type {module:ol/Feature} */ (event.feature);\n    this.watchFeature_(feature);\n  }\n\n\n  /**\n   * @param {ol.source.Vector.Event} event removeFeature event\n   * @private\n   */\n  handleRemoveFeature_(event) {\n    const feature = /** @type {module:ol/Feature} */ (event.feature);\n    this.unwatchFeature_(feature);\n  }\n\n\n  /**\n   * @param {module:ol/Feature} feature feature to watch\n   * @private\n   */\n  watchFeature_(feature) {\n\n    const ol3map = this.ol3map;\n    const gmap = this.gmap;\n    const data = this.data_;\n\n    // push to features (internal)\n    this.features_.push(feature);\n\n    const index = this.features_.indexOf(feature);\n\n    // create and activate feature herald\n    const options = {\n      feature: feature,\n      data: data,\n      index: index,\n      mapIconOptions: this.mapIconOptions_,\n      visible: this.visible_\n    };\n    const herald = new FeatureHerald(ol3map, gmap, options);\n    herald.activate();\n\n    // push to cache\n    this.cache_.push({\n      feature: feature,\n      herald: herald\n    });\n  }\n\n\n  /**\n   * @param {module:ol/Feature} feature feature to unwatch\n   * @private\n   */\n  unwatchFeature_(feature) {\n    const index = this.features_.indexOf(feature);\n    if (index !== -1) {\n      // remove from features (internal)\n      this.features_.splice(index, 1);\n      // deactivate feature herald\n      this.cache_[index].herald.deactivate();\n      // remove from cache\n      this.cache_.splice(index, 1);\n    }\n  }\n}\n\n\nexport default VectorFeatureHerald;\n"],"names":["super","this","const","let"],"mappings":"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"}