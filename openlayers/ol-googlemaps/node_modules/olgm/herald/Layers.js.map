{"version":3,"file":"Layers.js","sources":["../../../src/olgm/herald/Layers.js"],"sourcesContent":["/**\n * @module olgm/herald/Layers\n */\nimport ImageLayer from 'ol/layer/Image.js';\nimport TileLayer from 'ol/layer/Tile.js';\nimport VectorLayer from 'ol/layer/Vector.js';\nimport {unlistenAllByKey} from '../util.js';\nimport Herald from './Herald.js';\nimport ImageWMSSourceHerald from './ImageWMSSource.js';\nimport TileSourceHerald from './TileSource.js';\nimport VectorSourceHerald from './VectorSource.js';\nimport ViewHerald from './View.js';\nimport GoogleLayer from '../layer/Google.js';\n\n/**\n * @typedef {Object} GoogleLayerCache\n * @property {module:olgm/layer/Google} layer\n * @property {Array<module:ol/events~EventsKey|Array<module:ol/events~EventsKey>>} listenerKeys\n */\n\nclass LayersHerald extends Herald {\n  /**\n   * The Layers Herald is responsible of synchronizing the layers from the\n   * OpenLayers map to the Google Maps one. It listens to layers added and\n   * removed, and also takes care of existing layers when activated.\n   *\n   * It is also responsible of the activation and deactivation of the\n   * Google Maps map. When activated, it is rendered in the OpenLayers map\n   * target element, and the OpenLayers map is put inside the Google Maps map\n   * as a control that takes 100% of the size. The original state is restored\n   * when deactivated.\n   *\n   * The supported layers are:\n   *\n   * * {@link module:olgm/layer/Google~GoogleLayer}:\n   * When a google layer is added, the process of enabling the\n   * Google Maps  map is activated (if it is the first and if it's visible).\n   * If there is an existing and visible {@link module:olgm/layer/Google~GoogleLayer} in the map,\n   * then the top-most is used to define the map type id Google Maps has to\n   * switch to. **Limitation** The Google Maps map is always below the\n   * OpenLayers map, which means that the other OpenLayers layers are always\n   * on top of Google Maps.\n   *\n   * * {@link module:ol/layer/Vector~VectorLayer}:\n   * When a vector layers is added, a {@link module:olgm/herald/VectorFeature~VectorFeatureHerald} is created\n   * to manage its `ol.source.Vector`. The layer is immediately rendered\n   * fully transparent, making the interactions still possible over it\n   * while being invisible.\n   *\n   * @param {module:ol/PluggableMap} ol3map openlayers map\n   * @param {google.maps.Map} gmap google maps map\n   * @param {module:olgm/gm/MapIcon~Options} mapIconOptions map icon options\n   * @param {module:olgm/herald/Herald~WatchOptions} watchOptions for each layer,\n   * whether we should watch that type of layer or not\n   */\n  constructor(ol3map, gmap, mapIconOptions, watchOptions) {\n\n    super(ol3map, gmap);\n\n    /**\n     * @type {Array<module:olgm/layer/Google>}\n     * @private\n     */\n    this.googleLayers_ = [];\n\n    /**\n     * @type {Array<module:olgm/herald/Layers~GoogleLayerCache>}\n     * @private\n     */\n    this.googleCache_ = [];\n\n    /**\n     * @type {module:olgm/herald/ImageWMSSource}\n     * @private\n     */\n    this.imageWMSSourceHerald_ = new ImageWMSSourceHerald(ol3map, gmap);\n\n    /**\n     * @type {module:olgm/herald/TileSource}\n     * @private\n     */\n    this.tileSourceHerald_ = new TileSourceHerald(ol3map, gmap);\n\n    /**\n     * @type {module:olgm/herald/VectorSource}\n     * @private\n     */\n    this.vectorSourceHerald_ = new VectorSourceHerald(\n      ol3map, gmap, mapIconOptions);\n\n    /**\n     * @type {module:olgm/herald/View}\n     * @private\n     */\n    this.viewHerald_ = new ViewHerald(ol3map, gmap);\n\n    /**\n     * @type {module:olgm/herald/Herald~WatchOptions}\n     * @private\n     */\n    this.watchOptions_ = watchOptions;\n\n\n    // === Elements  === //\n\n    /**\n     * @type {Node}\n     * @private\n     */\n    this.gmapEl_ = gmap.getDiv();\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     */\n    this.ol3mapEl_ = ol3map.getViewport();\n\n    /**\n     * @type {HTMLElement}\n     * @private\n     */\n    this.targetEl_ = ol3map.getTargetElement();\n\n    /**\n     * Flag that determines whether the GoogleMaps map is currently active, i.e.\n     * is currently shown and has the OpenLayers map added as one of its control.\n     * @type {boolean}\n     * @private\n     */\n    this.googleMapsIsActive_ = false;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ol3mapIsRenderered_ = false;\n\n\n    // some controls, like the ol.control.ZoomSlider, require the map div\n    // to have a size. While activating Google Maps, the size of the ol3 map\n    // becomes moot. The code below fixes that.\n    const center = this.ol3map.getView().getCenter();\n    if (!center) {\n      this.ol3map.getView().once('change:center', () => {\n        this.ol3map.once('postrender', () => {\n          this.ol3mapIsRenderered_ = true;\n          this.toggleGoogleMaps_();\n        });\n        this.toggleGoogleMaps_();\n      });\n    } else {\n      this.ol3map.once('postrender', () => {\n        this.ol3mapIsRenderered_ = true;\n        this.toggleGoogleMaps_();\n      });\n    }\n  }\n\n\n  /**\n   * @inheritDoc\n   */\n  activate() {\n    super.activate();\n\n    const layers = this.ol3map.getLayers();\n\n    // watch existing layers\n    layers.forEach((layer) => this.watchLayer_(layer));\n\n    // event listeners\n    const keys = this.listenerKeys;\n    keys.push(layers.on('add', (event) => this.handleLayersAdd_(event)));\n    keys.push(layers.on('remove', (event) => this.handleLayersRemove_(event)));\n  }\n\n\n  /**\n   * @inheritDoc\n   */\n  deactivate() {\n    // unwatch existing layers\n    this.ol3map.getLayers().forEach((layer) => this.unwatchLayer_(layer));\n\n    super.deactivate();\n  }\n\n\n  /**\n   * @return {boolean} whether google maps is active or not\n   */\n  getGoogleMapsActive() {\n    return this.googleMapsIsActive_;\n  }\n\n\n  /**\n   * Set the googleMapsIsActive value and spread the change to the heralds\n   * @param {boolean} active value to update the google maps active flag with\n   * @private\n   */\n  setGoogleMapsActive_(active) {\n    this.googleMapsIsActive_ = active;\n    this.imageWMSSourceHerald_.setGoogleMapsActive(active);\n    this.tileSourceHerald_.setGoogleMapsActive(active);\n    this.vectorSourceHerald_.setGoogleMapsActive(active);\n  }\n\n\n  /**\n   * Set the watch options\n   * @param {module:olgm/herald/Herald~WatchOptions} watchOptions whether each layer type\n   * should be watched\n   * @api\n   */\n  setWatchOptions(watchOptions) {\n    this.watchOptions_ = watchOptions;\n\n    // Re-watch the appropriate layers\n    this.deactivate();\n    this.activate();\n  }\n\n\n  /**\n   * Callback method fired when a new layer is added to the map.\n   * @param {module:ol/Collection~CollectionEvent} event Collection event.\n   * @private\n   */\n  handleLayersAdd_(event) {\n    const layer = /** @type {module:ol/layer/Base} */ (event.element);\n    this.watchLayer_(layer);\n    this.orderLayers();\n  }\n\n\n  /**\n   * Callback method fired when a layer is removed from the map.\n   * @param {module:ol/Collection~CollectionEvent} event Collection event.\n   * @private\n   */\n  handleLayersRemove_(event) {\n    const layer = /** @type {module:ol/layer/Base} */ (event.element);\n    this.unwatchLayer_(layer);\n    this.orderLayers();\n  }\n\n\n  /**\n   * Watch the layer\n   * @param {module:ol/layer/Base} layer layer to watch\n   * @private\n   */\n  watchLayer_(layer) {\n    if (layer instanceof GoogleLayer) {\n      this.watchGoogleLayer_(layer);\n    } else if (layer instanceof VectorLayer &&\n          this.watchOptions_.vector !== false) {\n      this.vectorSourceHerald_.watchLayer(layer);\n    } else if (layer instanceof TileLayer &&\n          this.watchOptions_.tile !== false) {\n      this.tileSourceHerald_.watchLayer(layer);\n    } else if (layer instanceof ImageLayer &&\n          this.watchOptions_.image !== false) {\n      this.imageWMSSourceHerald_.watchLayer(layer);\n    }\n  }\n\n\n  /**\n   * Watch the google layer\n   * @param {module:olgm/layer/Google} layer google layer to watch\n   * @private\n   */\n  watchGoogleLayer_(layer) {\n    this.googleLayers_.push(layer);\n    this.googleCache_.push(/** @type {module:olgm/herald/Layers~GoogleLayerCache} */ ({\n      layer: layer,\n      listenerKeys: [\n        layer.on('change:visible', () => this.toggleGoogleMaps_())\n      ]\n    }));\n    this.toggleGoogleMaps_();\n  }\n\n\n  /**\n   * Unwatch the layer\n   * @param {module:ol/layer/Base} layer layer to unwatch\n   * @private\n   */\n  unwatchLayer_(layer) {\n    if (layer instanceof GoogleLayer) {\n      this.unwatchGoogleLayer_(layer);\n    } else if (layer instanceof VectorLayer) {\n      this.vectorSourceHerald_.unwatchLayer(layer);\n    } else if (layer instanceof TileLayer) {\n      this.tileSourceHerald_.unwatchLayer(layer);\n    } else if (layer instanceof ImageLayer) {\n      this.imageWMSSourceHerald_.unwatchLayer(layer);\n    }\n  }\n\n\n  /**\n   * Unwatch the google layer\n   * @param {module:olgm/layer/Google} layer google layer to unwatch\n   * @private\n   */\n  unwatchGoogleLayer_(layer) {\n    const index = this.googleLayers_.indexOf(layer);\n    if (index !== -1) {\n      this.googleLayers_.splice(index, 1);\n\n      const cacheItem = this.googleCache_[index];\n      unlistenAllByKey(cacheItem.listenerKeys);\n\n      this.googleCache_.splice(index, 1);\n\n      this.toggleGoogleMaps_();\n    }\n  }\n\n\n  /**\n   * Activates the GoogleMaps map, i.e. put it in the ol3 map target and put\n   * the ol3 map inside the gmap controls.\n   * @private\n   */\n  activateGoogleMaps_() {\n\n    const center = this.ol3map.getView().getCenter();\n    if (this.googleMapsIsActive_ || !this.ol3mapIsRenderered_ || !center) {\n      return;\n    }\n\n    this.targetEl_.removeChild(this.ol3mapEl_);\n    this.targetEl_.appendChild(this.gmapEl_);\n    const index = parseInt(google.maps.ControlPosition.TOP_LEFT, 10);\n    this.gmap.controls[index].push(\n      this.ol3mapEl_);\n\n    this.viewHerald_.activate();\n\n    // the map div of GoogleMaps doesn't like being tossed aroud. The line\n    // below fixes the UI issue of wrong size of the tiles of GoogleMaps\n    google.maps.event.trigger(this.gmap, 'resize');\n\n    // it's also possible that the google maps map is not exactly at the\n    // correct location. Fix this manually here\n    this.viewHerald_.setCenter();\n    this.viewHerald_.setRotation();\n    this.viewHerald_.setZoom();\n\n    this.setGoogleMapsActive_(true);\n\n    // activate all cache items\n    this.imageWMSSourceHerald_.activate();\n    this.tileSourceHerald_.activate();\n    this.vectorSourceHerald_.activate();\n\n    this.orderLayers();\n  }\n\n\n  /**\n   * Deactivates the GoogleMaps map, i.e. put the ol3 map back in its target\n   * and remove the gmap map.\n   * @private\n   */\n  deactivateGoogleMaps_() {\n\n    if (!this.googleMapsIsActive_) {\n      return;\n    }\n\n    const index = parseInt(google.maps.ControlPosition.TOP_LEFT, 10);\n    this.gmap.controls[index].removeAt(0);\n    this.targetEl_.removeChild(this.gmapEl_);\n    this.targetEl_.appendChild(this.ol3mapEl_);\n\n    this.viewHerald_.deactivate();\n\n    this.ol3mapEl_.style.position = 'relative';\n\n    // deactivate all cache items\n    this.imageWMSSourceHerald_.deactivate();\n    this.tileSourceHerald_.deactivate();\n    this.vectorSourceHerald_.deactivate();\n\n    this.setGoogleMapsActive_(false);\n  }\n\n\n  /**\n   * This method takes care of activating or deactivating the GoogleMaps map.\n   * It is activated if at least one visible Google layer is currently in the\n   * ol3 map (and vice-versa for deactivation). The top-most layer is used\n   * to determine that. It is also used to change the GoogleMaps mapTypeId\n   * accordingly too to fit the top-most ol3 Google layer.\n   * @private\n   */\n  toggleGoogleMaps_() {\n\n    let found = null;\n\n    // find top-most Google layer\n    this.ol3map.getLayers().getArray().slice(0).reverse().every(\n      function(layer) {\n        if (layer instanceof GoogleLayer &&\n              layer.getVisible() &&\n              this.googleLayers_.indexOf(layer) !== -1) {\n          found = layer;\n          return false;\n        } else {\n          return true;\n        }\n      },\n      this);\n\n    if (found) {\n      // set mapTypeId\n      this.gmap.setMapTypeId(found.getMapTypeId());\n      // set styles\n      const styles = found.getStyles();\n      if (styles) {\n        this.gmap.setOptions({'styles': styles});\n      } else {\n        this.gmap.setOptions({'styles': null});\n      }\n\n      // activate\n      this.activateGoogleMaps_();\n    } else {\n      // deactivate\n      this.deactivateGoogleMaps_();\n    }\n  }\n\n\n  /**\n   * Order the layers for each herald that supports it\n   * @api\n   */\n  orderLayers() {\n    this.imageWMSSourceHerald_.orderLayers();\n    this.tileSourceHerald_.orderLayers();\n  }\n\n\n  /**\n   * For each layer type that support refreshing, tell them to refresh\n   * @api\n   */\n  refresh() {\n    this.imageWMSSourceHerald_.refresh();\n  }\n}\n\n\nexport default LayersHerald;\n"],"names":["super","const","this","let"],"mappings":"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"}