



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>4. Y si los datos son enormes - Curso WebGIS. Mapas libres con Leaflet y OpenLayers</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#y-si-los-datos-son-enormes" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Curso WebGIS. Mapas libres con Leaflet y OpenLayers
              </span>
              <span class="md-header-nav__topic">
                4. Y si los datos son enormes
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Curso WebGIS. Mapas libres con Leaflet y OpenLayers
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_creando_mapa/" title="1. Creando un mapa" class="md-nav__link">
      1. Creando un mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2_capas_base/" title="2. El mapa sin datos. Añadir una capa base" class="md-nav__link">
      2. El mapa sin datos. Añadir una capa base
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3_mis_datos/" title="3. Mas allá de la capa base, añadiendo mis propios datos" class="md-nav__link">
      3. Mas allá de la capa base, añadiendo mis propios datos
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        4. Y si los datos son enormes
      </label>
    
    <a href="./" title="4. Y si los datos son enormes" class="md-nav__link md-nav__link--active">
      4. Y si los datos son enormes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wmts" title="WMTS" class="md-nav__link">
    WMTS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xyz" title="XYZ" class="md-nav__link">
    XYZ
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_interactuando_mapa/" title="5. Interactuando con el mapa" class="md-nav__link">
      5. Interactuando con el mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6_osm_y_tilemill/" title="6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres" class="md-nav__link">
      6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_extra_1_osm_y_umap/" title="7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap" class="md-nav__link">
      7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wmts" title="WMTS" class="md-nav__link">
    WMTS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xyz" title="XYZ" class="md-nav__link">
    XYZ
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/xeoinquedos/curso-webgis/edit/master/docs/4_wms_wmts.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="y-si-los-datos-son-enormes">Y si los datos son enormes</h1>
<div class="admonition note">
<p class="admonition-title">Autores</p>
<ul>
<li>Micho García · <a href="https://twitter.com/michogar">@michogar</a> · <a href="micho.garcia@geomati.co">micho.garcia@geomati.co</a></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Licencia</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />Esta obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Atribución-CompartirIgual 4.0 Internacional</a>.</p>
</div>
<p>En el apartado anterior hemos utilizado el servicio WFS para la descarga de datos. Lo que conseguíamos era descargar archivos en formato GeoJSON con las geometrías y las representábamos en nuestro visor. ¿Qué pasaría si quisiéramos descargar todas las carreteras de la Península en ese formato?, el tamaño del archivo sería muy grande y tardaríamos una eternidad en descargarlo. </p>
<p>Habitualmente los servicios WFS están limitados para realizar grandes descargas ya que son peticiones que podrían tirar un servidor. Y en el caso de que se permita la descarga de grandes datos, es conveniente utilizar filtros o limitantes del número de elementos a descargar.</p>
<p>Siguiendo con el ejemplo que anterior, el de las carreteras de la Península, ¿cómo haríamos para descargar la Red de Carreteras de España?. Para esto podríamos utilizar un servicio que ya conocemos, el WMS. </p>
<p>La Red de Carreteras está proporcionado por el <a href="http://www.ign.es/web/ign/portal">IGN</a> y se pueden ver las capacidades del servicio <a href="http://www.ign.es/wms-inspire/ign-base?request=GetCapabilities&amp;service=WMS">aquí</a>.</p>
<p>Crearemos una carpeta <code>ol-wms</code> con un archivo <code>index.html</code> de la siguiente manera</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WMS y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">8.8120584</span><span class="p">,</span> <span class="mf">42.2154941</span><span class="p">]),</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">12</span>
        <span class="p">})</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>en este caso la capa WMS que añadiremos será la correspondiente a las carreteras. Si inspeccionamos el servicio, encontraremos lo que necesitamos</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;Layer</span> <span class="na">queryable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<span class="hll"><span class="nt">&lt;Name&gt;</span>IGNBaseOrto<span class="nt">&lt;/Name&gt;</span>
</span><span class="nt">&lt;Title&gt;</span>Callejero para imagen<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;Abstract&gt;</span>
Representación cartográfica preparada para superponer la información geográfica sobre otros fondos como las ortoimágenes.
<span class="nt">&lt;/Abstract&gt;</span>
<span class="nt">&lt;KeywordList&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>Hidrografía<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>Transporte<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>Catastro<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>BTN<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>Cartociudad<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;/KeywordList&gt;</span>
<span class="nt">&lt;CRS&gt;</span>EPSG:4258<span class="nt">&lt;/CRS&gt;</span>
<span class="nt">&lt;EX_GeographicBoundingBox&gt;</span>
<span class="nt">&lt;westBoundLongitude&gt;</span>-19.0<span class="nt">&lt;/westBoundLongitude&gt;</span>
<span class="nt">&lt;eastBoundLongitude&gt;</span>5.0<span class="nt">&lt;/eastBoundLongitude&gt;</span>
<span class="nt">&lt;southBoundLatitude&gt;</span>27.0<span class="nt">&lt;/southBoundLatitude&gt;</span>
<span class="nt">&lt;northBoundLatitude&gt;</span>44.0<span class="nt">&lt;/northBoundLatitude&gt;</span>
<span class="nt">&lt;/EX_GeographicBoundingBox&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;CRS:84&quot;</span> <span class="na">minx=</span><span class="s">&quot;-19.0&quot;</span> <span class="na">miny=</span><span class="s">&quot;27.0&quot;</span> <span class="na">maxx=</span><span class="s">&quot;5.0&quot;</span> <span class="na">maxy=</span><span class="s">&quot;44.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4258&quot;</span> <span class="na">minx=</span><span class="s">&quot;27.0&quot;</span> <span class="na">miny=</span><span class="s">&quot;-19.0&quot;</span> <span class="na">maxx=</span><span class="s">&quot;44.0&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4326&quot;</span> <span class="na">minx=</span><span class="s">&quot;27.000000021351063&quot;</span> <span class="na">miny=</span><span class="s">&quot;-19.000000000000007&quot;</span> <span class="na">maxx=</span><span class="s">&quot;44.000000040852704&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:3857&quot;</span> <span class="na">minx=</span><span class="s">&quot;-2115070.3250721986&quot;</span> <span class="na">miny=</span><span class="s">&quot;3123471.7517721104&quot;</span> <span class="na">maxx=</span><span class="s">&quot;556597.4539663679&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5465442.189644802&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:3035&quot;</span> <span class="na">minx=</span><span class="s">&quot;471468.5017937361&quot;</span> <span class="na">miny=</span><span class="s">&quot;1445891.6963879904&quot;</span> <span class="na">maxx=</span><span class="s">&quot;2768821.4534321986&quot;</span> <span class="na">maxy=</span><span class="s">&quot;3919390.1873301356&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25828&quot;</span> <span class="na">minx=</span><span class="s">&quot;102948.3712066114&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.2424698113&quot;</span> <span class="na">maxx=</span><span class="s">&quot;2508202.7078731647&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5070480.910834041&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25829&quot;</span> <span class="na">minx=</span><span class="s">&quot;-495135.75545797264&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.1382796224&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1897204.2192799984&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4968139.496861154&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25830&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1099673.713805158&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.2424698113&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1295248.9457888722&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4998012.35979611&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25831&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1714549.1480732663&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.1382796224&quot;</span> <span class="na">maxx=</span><span class="s">&quot;698454.2342175536&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5113259.329733409&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32628&quot;</span> <span class="na">minx=</span><span class="s">&quot;102948.37128314428&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.244922726&quot;</span> <span class="na">maxx=</span><span class="s">&quot;2508202.7074604286&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5070480.915489917&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32629&quot;</span> <span class="na">minx=</span><span class="s">&quot;-495135.75526346336&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.140733385&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1897204.2190024962&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4968139.50151943&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32630&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1099673.713484239&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.244922726&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1295248.94563436&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4998012.364454182&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32631&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1714549.1476116255&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.140733385&quot;</span> <span class="na">maxx=</span><span class="s">&quot;698454.2341793771&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5113259.334386855&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;Attribution&gt;</span>
<span class="nt">&lt;Title&gt;</span>Sistema Cartográfico Nacional<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.scne.es&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Attribution&gt;</span>
<span class="nt">&lt;AuthorityURL</span> <span class="na">name=</span><span class="s">&quot;IGN&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AuthorityURL&gt;</span>
<span class="nt">&lt;Identifier</span> <span class="na">authority=</span><span class="s">&quot;IGN&quot;</span><span class="nt">&gt;</span>ignbase_orto<span class="nt">&lt;/Identifier&gt;</span>
<span class="nt">&lt;MetadataURL</span> <span class="na">type=</span><span class="s">&quot;ISO19115:2003&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;Format&gt;</span>text/plain<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es/csw-inspire/srv/spa/csw?SERVICE=CSW&amp;VERSION=2.0.2&amp;REQUEST=GetRecordById&amp;outputSchema=http://www.isotc211.org/2005/gmd&amp;ElementSetName=full&amp;ID=spaigncapawmswmtswmscignbaseorto20140301&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/MetadataURL&gt;</span>
<span class="nt">&lt;Style&gt;</span>
<span class="nt">&lt;Name&gt;</span>default<span class="nt">&lt;/Name&gt;</span>
<span class="nt">&lt;Title&gt;</span>IGN- Base: Estilo para imagen<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;Abstract&gt;</span>
Representación de objetos geográficos conforme al estilo definido para ellos en función de su tipología y con el fin de ser utilizados con cartografía de fondo, especiamente ortofotografía.
<span class="nt">&lt;/Abstract&gt;</span>
<span class="nt">&lt;LegendURL</span> <span class="na">width=</span><span class="s">&quot;202&quot;</span> <span class="na">height=</span><span class="s">&quot;117&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;Format&gt;</span>image/png<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es/wms-inspire/ign-base/leyendas/ignbase_orto.png&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/LegendURL&gt;</span>
<span class="nt">&lt;/Style&gt;</span>
<span class="nt">&lt;/Layer&gt;</span>
</pre></div>
</td></tr></table>

<p>y configuraremos la capa en nuestro visor de la siguiente manera.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WMS y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kr">const</span> <span class="nx">carreteras</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
        <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageWMS</span><span class="p">({</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wms-inspire/ign-base?&#39;</span><span class="p">,</span>
          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="s1">&#39;IGNBaseOrto&#39;</span><span class="p">},</span>
        <span class="p">})</span>
      <span class="p">})</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">8.8120584</span><span class="p">,</span> <span class="mf">42.2154941</span><span class="p">]),</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">12</span>
        <span class="p">}),</span>
      <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">carreteras</span>
      <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Ya podemos ver la Red de Carreteras en nuestro visor. Si inspeccionásemos la pestaña <em>Network</em> de la consola de desarrolladores de nuestro navegador, podríamos ver que cada vex que movemos el mapa se realiza una petición al servicio </p>
<p><img alt="Peticiones" src="../_images/peticiones.gif" /></p>
<p>Si abrimos alguna de estas peticiones comprobaremos que lo que nos está devolviendo es una imagen</p>
<p><a href="http://www.ign.es/wms-inspire/ign-base?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;FORMAT=image%2Fpng&amp;TRANSPARENT=true&amp;LAYERS=IGNBaseOrto&amp;CRS=EPSG%3A3857&amp;STYLES=&amp;WIDTH=768&amp;HEIGHT=384&amp;BBOX=-985655.4797373477%2C5199705.2861274%2C-956303.6608758401%2C5214381.195558153">http://www.ign.es/wms-inspire/ign-base?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;FORMAT=image%2Fpng&amp;TRANSPARENT=true&amp;LAYERS=IGNBaseOrto&amp;CRS=EPSG%3A3857&amp;STYLES=&amp;WIDTH=768&amp;HEIGHT=384&amp;BBOX=-985655.4797373477%2C5199705.2861274%2C-956303.6608758401%2C5214381.195558153</a></p>
<p><img alt="Petición" src="../_images/una_peticion.png" /></p>
<p>Lo que estamos haciendo es pedir imágenes cada vez que movemos el mapa. Y aunque el movimiento sea mínimo, y la mayor parte del mapa no la vayamos a refrescar, el servicio hace una peticion de todo el mapa, algo que no es nada óptimo.</p>
<p>Para resolver este tema se creó el concepto de <code>Tile</code> o <code>Tesela</code> en castellano, que se trataba de cortar la imagen en cuadrados de un tamaño dado como si se tratase de azulejos (de hay el nombre de <a href="https://translate.google.com/#en/es/tile"><code>Tile</code></a>)</p>
<p><img alt="" src="../_images/Tiled_web_map_Stevage.png" />
<em>By Stevage - Own work, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=34728162</em></p>
<p>Hay varios estándares que trabajan de esta manera, TMS, WMS-T o el estandar de facto XYZ. A continuación veremos algunos de ellos.</p>
<h2 id="wmts">WMTS</h2>
<p>Tal vez los conceptos del WMTS sean complejos y se escapan al objetivo de este curso, así que simplemente daremos unas recetas de como implementar estos servicios. </p>
<p>Lo primero crear una carpeta <code>ol-wmts</code> con un archivo <code>index.html</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WMTS y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">8.8120584</span><span class="p">,</span> <span class="mf">42.2154941</span><span class="p">]),</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">12</span>
        <span class="p">})</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Las capas teseladas se implementan en OpenLayers mediante el objeto <code>ol.layer.Tile</code>. Este objeto tiene varias fuentes posibles para servidores WMS: <code>ol.source.TileWMS</code> y <code>ol.source.ImageWMS</code></p>
<p>OpenLayers también nos proporciona el objeto <code>ol.source.WMTS</code>, que nos permite realizar peticiones de teselas de un servidor WMTS.</p>
<p>La clase <code>ol.source.WMTS</code>  acepta una serie de propiedades para controlar los parámetros del WMTS que sacaremos como siempre de las capacidades del servicio</p>
<ul>
<li>url: La url del servidor. En nuestro caso: <code>http://www.ign.es/wmts/mapa-raster</code>.</li>
<li>layer: el nombre de la capa. <code>MTN</code>.</li>
<li>style: el estilo que se usará (debe estar en el servidor).</li>
<li>matrixSet: el nombre de la matriz que usaremos. En nuestro caso <code>EPSG:4326</code>.</li>
<li>tileGrid: especifica la malla de teselas que se utilizará. Debe ser una instancia de <code>ol.tilegrid.WMTS</code>. En el que se indicará la proyección, resolución y matriz.</li>
</ul>
<p>Estos datos, como hemos hecho hasta ahora, los obtendremos de las capacidades del servicio que podemos ver en <a href="http://www.ign.es/wmts/mapa-raster?request=GetCapabilities&amp;service=WMTS">http://www.ign.es/wmts/mapa-raster?request=GetCapabilities&amp;service=WMTS</a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;Layer&gt;</span>
<span class="nt">&lt;ows:Title&gt;</span>Cartografía del IGN<span class="nt">&lt;/ows:Title&gt;</span>
<span class="nt">&lt;ows:Abstract&gt;</span>
Capa de cartografía raster del IGN. Datos mostrados en función de la escala de visualización: - Mapa 2M: hasta 305m/px. - Mapa 1M: hasta 152 m/px. - Mapa 500: hasta 50 m/px. - Mapa 200: hasta 20 m/px. - MTN50: hasta 5 m/px. - MTN25: desde 5 m/px
<span class="nt">&lt;/ows:Abstract&gt;</span>
<span class="nt">&lt;ows:WGS84BoundingBox&gt;</span>
<span class="nt">&lt;ows:LowerCorner&gt;</span>-18.162 21.899<span class="nt">&lt;/ows:LowerCorner&gt;</span>
<span class="nt">&lt;ows:UpperCorner&gt;</span>6.289 45.286<span class="nt">&lt;/ows:UpperCorner&gt;</span>
<span class="nt">&lt;/ows:WGS84BoundingBox&gt;</span>
<span class="hll"><span class="nt">&lt;ows:Identifier&gt;</span>MTN<span class="nt">&lt;/ows:Identifier&gt;</span>
</span><span class="nt">&lt;ows:Metadata</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es/csw-inspire/srv/spa/csw?SERVICE=CSW&amp;VERSION=2.0.2&amp;REQUEST=GetRecordById&amp;outputSchema=http://www.isotc211.org/2005/gmd&amp;ElementSetName=full&amp;ID=spaigncapawmtswmscmaparaster20130531&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;Style</span> <span class="na">isDefault=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;ows:Identifier&gt;</span>default<span class="nt">&lt;/ows:Identifier&gt;</span>
<span class="nt">&lt;ows:LegendURL</span> <span class="na">width=</span><span class="s">&quot;1295&quot;</span> <span class="na">height=</span><span class="s">&quot;346&quot;</span> <span class="na">format=</span><span class="s">&quot;image/png&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es/wms-inspire/mapa-raster/leyendas/mtn25.png&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Style&gt;</span>
<span class="nt">&lt;Format&gt;</span>image/jpeg<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;Format&gt;</span>image/png<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>InspireCRS84Quad<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="hll"><span class="nt">&lt;TileMatrixSet&gt;</span>EPSG:4326<span class="nt">&lt;/TileMatrixSet&gt;</span>
</span><span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>EPSG:4258<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>EPSG:32630<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>EPSG:25830<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>EPSG:32628<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>EPSG:25828<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSetLink&gt;</span>
<span class="nt">&lt;TileMatrixSet&gt;</span>GoogleMapsCompatible<span class="nt">&lt;/TileMatrixSet&gt;</span>
<span class="nt">&lt;/TileMatrixSetLink&gt;</span>
<span class="nt">&lt;/Layer&gt;</span>
</pre></div>
</td></tr></table>

<p>Aquí vemos el código necesario para mostrar una capa teselada del IGN en WGS84 utilizando una fuente WMTS:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WMTS y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">8.8120584</span><span class="p">,</span> <span class="mf">42.2154941</span><span class="p">]),</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">8</span>
        <span class="p">})</span>
      <span class="p">});</span>

    <span class="kr">const</span> <span class="nx">projection</span> <span class="o">=</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">projectionExtent</span> <span class="o">=</span> <span class="nx">projection</span><span class="p">.</span><span class="nx">getExtent</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">extent</span><span class="p">.</span><span class="nx">getWidth</span><span class="p">(</span><span class="nx">projectionExtent</span><span class="p">)</span> <span class="o">/</span> <span class="mi">512</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">resolutions</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">matrixIds</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">z</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">;</span> <span class="o">++</span><span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">resolutions</span><span class="p">[</span><span class="nx">z</span><span class="p">]</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">z</span><span class="p">);</span>
         <span class="nx">matrixIds</span><span class="p">[</span><span class="nx">z</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;EPSG:4326:&quot;</span> <span class="o">+</span> <span class="nx">z</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="nx">tileGrid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">tilegrid</span><span class="p">.</span><span class="nx">WMTS</span><span class="p">({</span>
      <span class="nx">origin</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">extent</span><span class="p">.</span><span class="nx">getTopLeft</span><span class="p">(</span><span class="nx">projectionExtent</span><span class="p">),</span>
      <span class="nx">resolutions</span><span class="o">:</span> <span class="nx">resolutions</span><span class="p">,</span>
      <span class="nx">matrixIds</span><span class="o">:</span> <span class="nx">matrixIds</span>
    <span class="p">});</span>

    <span class="kr">const</span> <span class="nx">ign_source</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">WMTS</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wmts/mapa-raster&#39;</span><span class="p">,</span>
        <span class="nx">layer</span><span class="o">:</span> <span class="s1">&#39;MTN&#39;</span><span class="p">,</span>
        <span class="nx">matrixSet</span><span class="o">:</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span>
        <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
        <span class="nx">projection</span><span class="o">:</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span>
        <span class="nx">tileGrid</span><span class="o">:</span> <span class="nx">tileGrid</span><span class="p">,</span>
        <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
        <span class="nx">attributions</span><span class="o">:</span> <span class="s1">&#39;&lt;a href=&quot;http://www.ign.es&quot; target=&quot;_blank&quot;&gt;IGN.es&lt;/a&gt;&#39;</span>
    <span class="p">});</span>

    <span class="kr">const</span> <span class="nx">ign</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
       <span class="nx">source</span><span class="o">:</span> <span class="nx">ign_source</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">ign</span><span class="p">);</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Si ahora revisamos la pestaña <em>Network</em> del navegador, comprobaremos que la carga de la imagen se realiza en porciones, <code>teselas</code> de manera más fluida. Si inspeccionamos una de estas peticiones podremos comprobar en efecto como cada una de ellas corresponde a una de estas teselas.</p>
<p><img alt="Teselas" src="../_images/teselas.gif" /></p>
<p><a href="http://www.ign.es/wmts/mapa-raster?layer=MTN&amp;style=normal&amp;tilematrixset=EPSG%3A4326&amp;Service=WMTS&amp;Request=GetTile&amp;Version=1.0.0&amp;Format=image%2Fjpeg&amp;TileMatrix=EPSG%3A4326%3A9&amp;TileCol=511&amp;TileRow=144">http://www.ign.es/wmts/mapa-raster?layer=MTN&amp;style=normal&amp;tilematrixset=EPSG%3A4326&amp;Service=WMTS&amp;Request=GetTile&amp;Version=1.0.0&amp;Format=image%2Fjpeg&amp;TileMatrix=EPSG%3A4326%3A9&amp;TileCol=511&amp;TileRow=144</a></p>
<p><img alt="Tesela image" src="../_images/tesela.image" /></p>
<h2 id="xyz">XYZ</h2>
<p>El estandar de facto <a href="https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames">XYZ</a> se trata de una convención que "naming" para la publicación de información geográfica desde una estructura de directorios. </p>
<p>Así, se deberá cumplir las siguientes especificaciones para que se trate de este tipo de servicio</p>
<ul>
<li>Las <code>teselas</code> que se sirvan deberán tener un tamaño de 256 x 256 pixels y en formato PNG</li>
<li>Cada nivel de zoom será un directorio, cada columna es un subdirectorio y cada tesela es un archivo dentro de ese directorio.</li>
<li>La URL a cada archivo será de la forma <code>zoom/x/y.png</code></li>
</ul>
<p>Lo que se define es como tiene que ser la estructura de las carpetas que podremos servir directamente desde un servidor HTTP común. El inconveniente de este tipo de servicios es que necesitan de una gran capacidad de almacenamiento. Como podemos ver en la imagen a continuación, el número de archivos va creciendo según aumentamos el nivel de zoom.</p>
<p><img alt="Zoom Levels" src="../_images/zoom_levels.png" />
Relación entre el número de archivos por nivel de zoom. Fuente: <a href="https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Zoom_levels">Zoom Levels. Wiki OpenStreetMap</a></p>
<p>Este tipo de servicios son utilizados de manera intensiva por la Comunidad de OpenStreetMap, y en su <a href="https://wiki.openstreetmap.org/wiki/Tile_servers">Wiki</a> podremos encontrar varios de estos servicios que están a nuestra disposición.</p>
<p>Para configurar un servicio XYZ con OpenLayers, lo primero será crear la carpeta <code>ol-xyz</code> y añadiremos nuestra plantilla <code>index.html</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>XYZ y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kr">const</span> <span class="nx">PNOA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
        <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageWMS</span><span class="p">({</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wms-inspire/pnoa-ma?&#39;</span><span class="p">,</span>
          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="s1">&#39;OI.OrthoimageCoverage&#39;</span><span class="p">},</span>
        <span class="p">})</span>
      <span class="p">})</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">8.8120584</span><span class="p">,</span> <span class="mf">42.2154941</span><span class="p">]),</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">11</span>
        <span class="p">}),</span>
      <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">PNOA</span>
      <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>El objeto que nuevo utilizaremos para configurar este tipo de servicios será la fuente <code>ol.source.XYZ</code> junto con la ya conocida <code>ol.layer.Tile</code>. Simplemente necesitaremos la URL del servicio. Para nuestro caso, utilizaremos los datos de OpenSeaMap, cuya URL del servicio será <a href="http://tiles.openseamap.org/seamark/${z}/${x}/${y}.png">http://tiles.openseamap.org/seamark/${z}/${x}/${y}.png</a></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>XYZ y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kr">const</span> <span class="nx">PNOA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
        <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageWMS</span><span class="p">({</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wms-inspire/pnoa-ma?&#39;</span><span class="p">,</span>
          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="s1">&#39;OI.OrthoimageCoverage&#39;</span><span class="p">},</span>
        <span class="p">})</span>
      <span class="p">})</span>
<span class="hll">      <span class="kr">const</span> <span class="nx">seaMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
</span><span class="hll">            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">XYZ</span><span class="p">({</span>
</span><span class="hll">              <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png&#39;</span>
</span><span class="hll">            <span class="p">})</span>
</span><span class="hll">          <span class="p">})</span>
</span>      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">8.8120584</span><span class="p">,</span> <span class="mf">42.2154941</span><span class="p">]),</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">11</span>
        <span class="p">}),</span>
      <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">PNOA</span><span class="p">,</span>
<span class="hll">        <span class="nx">seaMap</span>
</span>      <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p><a href="./../leaflet/4_wms_wmts">Probar con Leaflet</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../3_mis_datos/" title="3. Mas allá de la capa base, añadiendo mis propios datos" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                3. Mas allá de la capa base, añadiendo mis propios datos
              </span>
            </div>
          </a>
        
        
          <a href="../5_interactuando_mapa/" title="5. Interactuando con el mapa" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                5. Interactuando con el mapa
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>