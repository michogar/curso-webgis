



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>2. El mapa sin datos. Añadir una capa base - Curso WebGIS. Mapas libres con Leaflet y OpenLayers</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#el-mapa-sin-datos-anadir-una-capa-base" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Curso WebGIS. Mapas libres con Leaflet y OpenLayers
              </span>
              <span class="md-header-nav__topic">
                2. El mapa sin datos. Añadir una capa base
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Curso WebGIS. Mapas libres con Leaflet y OpenLayers" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Curso WebGIS. Mapas libres con Leaflet y OpenLayers
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/xeoinquedos/curso-webgis/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Curso WebGIS
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_creando_mapa/" title="1. Creando un mapa" class="md-nav__link">
      1. Creando un mapa
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        2. El mapa sin datos. Añadir una capa base
      </label>
    
    <a href="./" title="2. El mapa sin datos. Añadir una capa base" class="md-nav__link md-nav__link--active">
      2. El mapa sin datos. Añadir una capa base
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bing-maps" title="Bing Maps" class="md-nav__link">
    Bing Maps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-maps" title="Google Maps" class="md-nav__link">
    Google Maps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapbox" title="Mapbox" class="md-nav__link">
    Mapbox
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicios-de-mapas-locales-pnoa" title="Servicios de mapas locales. PNOA" class="md-nav__link">
    Servicios de mapas locales. PNOA
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pnoa" title="PNOA" class="md-nav__link">
    PNOA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3_mis_datos/" title="3. Mas allá de la capa base, añadiendo mis propios datos" class="md-nav__link">
      3. Mas allá de la capa base, añadiendo mis propios datos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../4_wms_wmts/" title="4. Y si los datos son enormes" class="md-nav__link">
      4. Y si los datos son enormes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_interactuando_mapa/" title="5. Interactuando con el mapa" class="md-nav__link">
      5. Interactuando con el mapa
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6_osm_y_tilemill/" title="6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres" class="md-nav__link">
      6. Usando OpenStreetMap como fuente de datos, Tilemill. Enlace a GeoTalleres
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_extra_1_osm_y_umap/" title="7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap" class="md-nav__link">
      7. Extra 1. Un visor rápido con datos vectoriales de OSM usando uMap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bing-maps" title="Bing Maps" class="md-nav__link">
    Bing Maps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#google-maps" title="Google Maps" class="md-nav__link">
    Google Maps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapbox" title="Mapbox" class="md-nav__link">
    Mapbox
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servicios-de-mapas-locales-pnoa" title="Servicios de mapas locales. PNOA" class="md-nav__link">
    Servicios de mapas locales. PNOA
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pnoa" title="PNOA" class="md-nav__link">
    PNOA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/xeoinquedos/curso-webgis/edit/master/docs/2_capas_base.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="el-mapa-sin-datos-anadir-una-capa-base">El mapa sin datos. Añadir una capa base</h1>
<div class="admonition note">
<p class="admonition-title">Autores</p>
<ul>
<li>Micho García · <a href="https://twitter.com/michogar">@michogar</a> · <a href="micho.garcia@geomati.co">micho.garcia@geomati.co</a></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Licencia</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />Esta obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Atribución-CompartirIgual 4.0 Internacional</a>.</p>
</div>
<p>Como hemos visto antes, hemos podido ver datos en el momento que hemos añadido la capa de OpenStreetMap. Uno de los primeros retos con los que se enfrenta uno al crear visores web es el crear un mapa con una capa base. Hasta ahora el uso de Google Maps ha difundido la imagen del mapa con las diferentes capas que Google proporciona, satélite, terreno y mapas.</p>
<p>Utilizando las librerías de mapas libres como Ol y Leeaflet, podremos realizar visores similares utilizando los servicios de mapas globales más comunes como son Bing o Google Maps.</p>
<h2 id="bing-maps">Bing Maps</h2>
<p>En julio del 2010 Microsoft firmo un acuerdo con DigitalGlobe, un proveedor de imágenes satelitales para generar una ortofoto aerea de cobertura global dentro del programa Ortho Aerial de la compañia.</p>
<p>Estas compañías de servicios de mapas generalmente funcionan con pago por consumo de porción de mapa (tesela), y habrá que generar un token de identificación para poder consumir sus servicios.</p>
<p>Para obtener una key que nos permita el uso de estos datos iremos a <a href="https://www.bingmapsportal.com/">https://www.bingmapsportal.com/</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Para uso durante el curso podréis usar la key <strong>AqU3C-Sa7exTZ1zqoy25oXm8H0MFgMxG3_ZKV87ZVZcX27RIzUrNQ5rQOV1DKt3t</strong></p>
</div>
<p>Siguiendo con el ejemplo anterior, sustituiremos la capa de OSM por la nueva de Bing y añadiremos un control que nos permita cambiar entre las diferentes tipos de capas de Bing</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Bing Maps<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">1</span>
        <span class="p">})</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Hasta ahora nada nuevo. Hemos creado un mapa con una vista centrada en las coordenadas latitud 0 y longitud 0 y con un nivel de zoom 1 que será el más grande, donde podremos ver todo el mundo.</p>
<p>Lo siguiente como habíamos visto sería insertar la capa de Bing Maps. En este caso haremos una colección con todas las capas que Bing nos ofrece para poder ir seleccionandolas una a una. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Bing Maps<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="hll">        <span class="kd">let</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">            <span class="s1">&#39;Road&#39;</span><span class="p">,</span>
</span><span class="hll">            <span class="s1">&#39;Aerial&#39;</span><span class="p">,</span>
</span><span class="hll">            <span class="s1">&#39;AerialWithLabels&#39;</span>
</span><span class="hll">        <span class="p">];</span>
</span><span class="hll">        <span class="kd">let</span> <span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class="hll">        <span class="kd">let</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">;</span>
</span><span class="hll">        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">layers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
</span><span class="hll">                <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="hll">                <span class="nx">preload</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span><span class="hll">                <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">BingMaps</span><span class="p">({</span>
</span><span class="hll">                    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;AqU3C-Sa7exTZ1zqoy25oXm8H0MFgMxG3_ZKV87ZVZcX27RIzUrNQ5rQOV1DKt3t&#39;</span><span class="p">,</span>
</span><span class="hll">                    <span class="nx">imagerySet</span><span class="o">:</span> <span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span><span class="hll">                <span class="p">})</span>
</span><span class="hll">            <span class="p">}));</span>
</span><span class="hll">        <span class="p">}</span>
</span>        <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
            <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
                <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">zoom</span><span class="o">:</span> <span class="mi">1</span>
            <span class="p">}),</span>
<span class="hll">            <span class="nx">layers</span><span class="o">:</span> <span class="nx">layers</span>
</span>        <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Podemos observar que repetimos la manera de crear una capa. Si nos damos cuenta, otro concepto importante en la creación de la capa será el de <code>source</code> o fuente de datos, que será de donde la capa se nutre de la información que va a representar.
Observamos el uso de dos nuevas propiedades de la capa, <code>visible</code> que nos indica si la capa se ve o no se ve, en este caso, como es <code>false</code> las capas no se verán, y la propiedad <code>preload</code> que irá cargando porciones de mapa a baja resolución entre cambios de nivel de zoom.</p>
<p>De momento tendremos un mapa con unas capas sin visibilidad. Ahora crearemos un control que nos permita seleccionar la capa que deseemos y la haga visible.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Bing Maps<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="hll">    <span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;layer-select&quot;</span><span class="p">&gt;</span>
</span><span class="hll">       <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Aerial&quot;</span><span class="p">&gt;</span>Aerial<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
</span><span class="hll">       <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;AerialWithLabels&quot;</span> <span class="na">selected</span><span class="p">&gt;</span>Aerial with labels<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
</span><span class="hll">       <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Road&quot;</span><span class="p">&gt;</span>Road (static)<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
</span><span class="hll">    <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
</span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kd">let</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Road&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Aerial&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AerialWithLabels&#39;</span>
        <span class="p">];</span>
        <span class="kd">let</span> <span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">let</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">layers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
                <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">preload</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
                <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">BingMaps</span><span class="p">({</span>
                    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;AqU3C-Sa7exTZ1zqoy25oXm8H0MFgMxG3_ZKV87ZVZcX27RIzUrNQ5rQOV1DKt3t&#39;</span><span class="p">,</span>
                    <span class="nx">imagerySet</span><span class="o">:</span> <span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
                <span class="p">})</span>
            <span class="p">}));</span>
        <span class="p">}</span>
        <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
            <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
                <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="nx">zoom</span><span class="o">:</span> <span class="mi">1</span>
            <span class="p">}),</span>
            <span class="nx">layers</span><span class="o">:</span> <span class="nx">layers</span>
        <span class="p">});</span>

<span class="hll">        <span class="kd">let</span> <span class="nx">select</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;layer-select&#39;</span><span class="p">);</span>
</span><span class="hll">        <span class="kr">const</span> <span class="nx">onChange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="kd">let</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">select</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span class="hll">            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">layers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">                <span class="nx">layers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setVisible</span><span class="p">(</span><span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">style</span><span class="p">);</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">        <span class="nx">select</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">onChange</span><span class="p">);</span>
</span><span class="hll">        <span class="nx">onChange</span><span class="p">();</span>
</span>    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<h2 id="google-maps">Google Maps</h2>
<p>Google ha hecho mucho hincapie en que los desarrolladores usen sus librerías para el consumo de sus servicios. Aun así, se han ido articulando caminos para poder hacer uso de sus servicios de mapas desde librerías externas. En el caso de OpenLayers, en su versión actual 5.2.0, la gente de <a href="http://www.mapgears.com/">Mapgears</a> han implementado una librería que permite realizar este uso de los servicios de Google desde OL. Como en el caso de Bing, será necesario obtener una key para poder acceder a los mapas. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Documentación para la creación de API keys de Google <a href="https://developers.google.com/maps/documentation/javascript/get-api-key">https://developers.google.com/maps/documentation/javascript/get-api-key</a></p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Para el curso se podrá utilizar la key <strong>AIzaSyCqPQ0dabDFcqSrjGVLvWGyDU3RSgAXayo</strong></p>
</div>
<p>Para hacer uso de esta librería necesitaremos tener un gestor de paquetes como <code>npm</code> con el que importar la librería de Mapgears. Para ello crearemos una carpeta <code>ol-googlemaps</code> y dentro de ella arrancaremos nuestro proyecto usando <code>npm</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ mkdir ol-googlemaps
$ <span class="nb">cd</span> ol-googlemaps
$ npm init
</pre></div>
</td></tr></table>

<p>Una vez terminado el proceso de creación de nuestro proyecto instalaremos las dependencias del mismo, <code>openlayers</code> y <code>olgm</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ npm install ol olgm
</pre></div>
</td></tr></table>

<p>Para poder hacer uso de las librerías deberemos instalar una herramienta que nos permita este uso</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ npm install --save-dev parcel-bundler
</pre></div>
</td></tr></table>

<p>Dentro de la carpeta <code>ol-googlemaps</code> crearemos un archivo <code>index.js</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="s1">&#39;ol/ol.css&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Map</span><span class="p">,</span> <span class="nx">View</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">TileLayer</span> <span class="nx">from</span> <span class="s1">&#39;ol/layer/Tile&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">OSM</span> <span class="nx">from</span> <span class="s1">&#39;ol/source/OSM&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">({</span>
  <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
  <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">TileLayer</span><span class="p">({</span>
      <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">OSM</span><span class="p">()</span>
    <span class="p">})</span>
  <span class="p">],</span>
  <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
    <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">zoom</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</td></tr></table>

<p>y seguidamente un fichero <code>index.html</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Using Parcel with OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
      <span class="nt">html</span><span class="o">,</span> <span class="nt">body</span><span class="o">,</span> <span class="p">#</span><span class="nn">map</span> <span class="p">{</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span>
<span class="hll">        <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://maps.googleapis.com/maps/api/js?v=3&amp;key=AIzaSyCqPQ0dabDFcqSrjGVLvWGyDU3RSgAXayo&quot;</span><span class="p">&gt;</span>
</span>    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./index.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Ahora crearemos las tareas de creación del visor mediante el uso de la herramienta. Para ello añadimos en el archivo <code>package.json</code> que se habrá creado tras la ejecución del comando <code>npm init</code> lo siguiente:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ol-googlemaps&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="p">,</span>
<span class="hll">    <span class="nt">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;parcel index.html&quot;</span><span class="p">,</span>
</span><span class="hll">    <span class="nt">&quot;build&quot;</span><span class="p">:</span> <span class="s2">&quot;parcel build --public-url . index.html&quot;</span>
</span>  <span class="p">},</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ol&quot;</span><span class="p">:</span> <span class="s2">&quot;^5.2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;olgm&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.0.0-beta.4&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>si ahora ejecutamos <code>npm start</code> podremos ver el visor en <a href="http://localhost:1234/">http://localhost:1234/</a></p>
<p>Añadiremos la capa de Google haciendo uso de la librería de Mapgears:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="s1">&#39;ol/ol.css&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s1">&#39;olgm/olgm.css&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Map</span><span class="p">,</span> <span class="nx">View</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ol&#39;</span><span class="p">;</span>
<span class="hll"><span class="kr">import</span> <span class="nx">GoogleLayer</span> <span class="nx">from</span> <span class="s1">&#39;olgm/layer/Google.js&#39;</span><span class="p">;</span>
</span><span class="hll"><span class="kr">import</span> <span class="p">{</span><span class="nx">defaults</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;olgm/interaction.js&#39;</span><span class="p">;</span>
</span><span class="hll"><span class="kr">import</span> <span class="nx">OLGoogleMaps</span> <span class="nx">from</span> <span class="s1">&#39;olgm/OLGoogleMaps.js&#39;</span><span class="p">;</span>
</span>
<span class="hll"><span class="kd">var</span> <span class="nx">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
</span>
<span class="hll"><span class="kr">const</span> <span class="nx">googleLayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GoogleLayer</span><span class="p">();</span>
</span>
<span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">({</span>
  <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
  <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
<span class="hll">    <span class="nx">googleLayer</span>
</span>  <span class="p">],</span>
  <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
    <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">zoom</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">})</span>
<span class="p">});</span>

<span class="hll"><span class="kd">var</span> <span class="nx">olGM</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OLGoogleMaps</span><span class="p">({</span><span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">});</span>
</span><span class="hll"><span class="nx">olGM</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
</span></pre></div>
</td></tr></table>

<p>Es posible que nos encontremos problemas a la hora de consumir los servicios de mapas de Google debido a las restricciones de uso de las Keys.</p>
<h2 id="mapbox">Mapbox</h2>
<p>Mapbox es un proveedor de mapas en línea personalizados para sitios web y aplicaciones como Foursquare, Lonely Planet, Facebook, el Financial Times, The Weather Channel y Snapchat. Desde 2010, ha ampliado rápidamente el nicho de mapas personalizados, como respuesta a la opción limitada que ofrecen los proveedores de mapas, como Google Maps. Mapbox es el creador, o un colaborador significativo de algunas bibliotecas y aplicaciones de mapeo de código abierto, incluida la especificación MBTiles, el IDE de cartografía TileMill, la biblioteca JavaScript Leaflet y el lenguaje y analizador de estilo de mapas CartoCSS.</p>
<p>Vamos a ver como es posible usar los mapas de Mapbox con OL. Para ello, como ya es común en este tipo de servicios donde el modelo de negocio es proveer un servicio web, deberemos darnos de alta y obtener un token con el que acceder a sus servicios.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Para obtener el token <a href="https://www.mapbox.com/">https://www.mapbox.com/</a>.
Durante el curso se podrá utilizar el token <em>pk.eyJ1IjoibWljaG9nYXIiLCJhIjoiY2ptN3UzNXJnMDhpcDNrbm9tczlibDMzbCJ9.zr2VPbydp2PhiAG5UxVn4w</em></p>
</div>
<p>Siguiendo con la dinámica, crearemos una carpeta <code>ol-mapbox</code> donde crearemos un archivo <code>ìndex.html</code> con el contenido necesario para empezar con un nuevo visor.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mapbox y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">})</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Ahora añadiremos la capa de Mapbox, en este caso será la capa <code>mapbox/street-v1</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mapbox y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">}),</span>
<span class="hll">        <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">          <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
</span><span class="hll">            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">XYZ</span><span class="p">({</span>
</span><span class="hll">              <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;https://api.mapbox.com/styles/v1/mapbox/streets-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWljaG9nYXIiLCJhIjoiY2ptN3UzNXJnMDhpcDNrbm9tczlibDMzbCJ9.zr2VPbydp2PhiAG5UxVn4w&#39;</span>
</span><span class="hll">            <span class="p">})</span>
</span><span class="hll">          <span class="p">})</span>
</span><span class="hll">        <span class="p">]</span>
</span>      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Mapbox nos ofrece la posibilidad de crear nuestros propios estilos y pone a disposición algunos. Siguiendo con el ejemplo de Bing, crearemos un selector que nos permita visualizar algunos de estos estilos. Primero crearemos una colección con los nombres de los estilos de los que disponemos en Mapbox y la lógica para crear cada capa. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mapbox y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="hll">      <span class="kd">let</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">          <span class="s1">&#39;basic&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="s1">&#39;streets&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="s1">&#39;bright&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="s1">&#39;light&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="s1">&#39;dark&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="s1">&#39;satellite&#39;</span>
</span><span class="hll">      <span class="p">];</span>
</span><span class="hll">      <span class="kd">let</span> <span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class="hll">      <span class="kd">let</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">;</span>
</span><span class="hll">      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">          <span class="nx">layers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
</span><span class="hll">              <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="hll">              <span class="nx">preload</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span><span class="hll">              <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">XYZ</span><span class="p">({</span>
</span><span class="hll">                <span class="nx">url</span><span class="o">:</span> <span class="sb">`https://api.mapbox.com/styles/v1/mapbox/</span><span class="si">${</span><span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="si">}</span><span class="sb">-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWljaG9nYXIiLCJhIjoiY2ptN3UzNXJnMDhpcDNrbm9tczlibDMzbCJ9.zr2VPbydp2PhiAG5UxVn4w`</span>
</span><span class="hll">              <span class="p">})</span>
</span><span class="hll">          <span class="p">})</span>
</span><span class="hll">        <span class="p">)</span>
</span><span class="hll">      <span class="p">}</span>
</span>      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">}),</span>
<span class="hll">        <span class="nx">layers</span>
</span>      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Ahora crearemos el selector de capas y la lógica que nos permita seleccionar la capa que deseamos ver.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mapbox y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">select</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;layer-select&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kr">const</span> <span class="nx">select</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;layer-select&#39;</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">&#39;basic&#39;</span><span class="p">,</span>
          <span class="s1">&#39;streets&#39;</span><span class="p">,</span>
          <span class="s1">&#39;bright&#39;</span><span class="p">,</span>
          <span class="s1">&#39;light&#39;</span><span class="p">,</span>
          <span class="s1">&#39;dark&#39;</span><span class="p">,</span>
          <span class="s1">&#39;satellite&#39;</span>
      <span class="p">];</span>
      <span class="kd">let</span> <span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">let</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">ii</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`https://api.mapbox.com/styles/v1/mapbox/</span><span class="si">${</span><span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="si">}</span><span class="sb">-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWljaG9nYXIiLCJhIjoiY2ptN3UzNXJnMDhpcDNrbm9tczlibDMzbCJ9.zr2VPbydp2PhiAG5UxVn4w`</span>
          <span class="nx">layers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
              <span class="nx">visible</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="nx">preload</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
              <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">XYZ</span><span class="p">({</span>
                <span class="nx">url</span>
              <span class="p">})</span>
          <span class="p">}));</span>
<span class="hll">        <span class="kr">const</span> <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
</span><span class="hll">        <span class="kr">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class="hll">        <span class="nx">option</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span><span class="hll">        <span class="nx">select</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
</span>      <span class="p">}</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">}),</span>
        <span class="nx">layers</span>
      <span class="p">});</span>
<span class="hll">      <span class="kr">const</span> <span class="nx">onChange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">          <span class="kd">let</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">select</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span class="hll">          <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">layers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">layers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setVisible</span><span class="p">(</span><span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">style</span><span class="p">);</span>
</span><span class="hll">          <span class="p">}</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">      <span class="nx">select</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">onChange</span><span class="p">);</span>
</span><span class="hll">      <span class="nx">onChange</span><span class="p">();</span>
</span>    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<h2 id="servicios-de-mapas-locales-pnoa">Servicios de mapas locales. PNOA</h2>
<p>Hasta ahora hemos hecho uso de servicios de datos mundiales. Todos ellos tienen cobertura global y son interesantes para aplicaciones que necesiten esa cobertura. Pero como hemos visto, en todos los casos el servicio era en pago por subscripción y en algunos casos, como en Google Maps, los datos no eran libres. </p>
<p>¿Existen servicios de mapas a otros niveles?, por suerte existe el concepto de IDE, <a href="https://es.wikipedia.org/wiki/Infraestructura_de_Datos_Espaciales">Infraestructura de Datos Espaciales. Wikipedia</a>, que son organismos encargados de generar u publicar datos geográficos para distintos niveles administrativos. Así, podremos encontrar IDEs <a href="http://www.idee.es/estatal#1md">nacionales</a>, <a href="http://mapas.xunta.gal/portada">autonómicas</a> e incluso <a href="https://ide.depo.gal/">locales</a>.</p>
<p>La mayoría de las IDEs tienen un catálogo de acceso a datos donde podremos encontrar los mapas que tienen publicados. En las IDEs los mapas se encuentran publicados con servicios <a href="https://en.wikipedia.org/wiki/Open_Geospatial_Consortium">OGC. Wikipedia</a> que es el organismo encargado de velar por los estándares de comunicación de servicios de información geográfica. </p>
<p>No es objetivo de este curso profundizar en los estándares de la OGC, pero si resulta inevitable hablar de ellos ya que será a través de estos como podremos acceder a mucha de la información geográfica que existe a nuestra disposición.</p>
<h3 id="pnoa">PNOA</h3>
<p>El <a href="http://pnoa.ign.es/">PNOA</a>, o Plan Nacional de Ortofografía Aerea, es un proyecto del <a href="http://www.ign.es">Instituto Geográfico Nacional</a> que <em>"tiene como objetivo la obtención de ortofotografías aéreas digitales con resolución de 25 ó 50 cm y modelos digitales de elevaciones (MDE) de alta precisión de todo el territorio español, con un período de actualización de 2 ó 3 años, según las zonas"</em>.</p>
<p>Lo que tendremos a nuestra disposición son ortofotos de toda la península a mucha resolución que podran ser consumidas desde los servicios del IGN.</p>
<p>Para hacer esto, comenzaremos creando una carpeta <code>ol-pnoa</code> con nuestro esqueléto básico de OpenLayers, pero esta vez tendremos en cuenta que estamos utilizando un servicio de la Península Ibérica por lo que centraremos el mapa sobre esta.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PNOA y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
<span class="hll">          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.6832130</span><span class="p">,</span> <span class="mf">40.2589448</span><span class="p">],</span>
</span>          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">6</span>
        <span class="p">})</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Después deberemos crear la capa que muestre el PNOA. Para ello haremos uso de uno de los servicios que nos proveé la OGC, el servicio WMS. Un servicio <a href="https://www.idecanarias.es/documentacion/ogc_wms">WMS. IdeCanarias</a>. Como ya hemos comentado antes, no es objetivo de este curso el profundizar en los detalles del estandar, simplemente aprenderemos como configurar una capa WMS usando la librería OpenLayers. Para empezar deberemos encontrar la URL del servicio. Habitualmente esto se realiza a través de los catálogos que las IDEs, por ejemplo el de la IDE Nacional, IDEE sería <a href="http://www.idee.es/csw-inspire-idee/srv/spa/catalog.search#/search?any=PNOA">esta búsqueda</a></p>
<p><img alt="Catalogo IDEE" src="../_images/catalogo_idee.png" /></p>
<p>Y el dato que nos interesa sería <a href="http://www.idee.es/csw-inspire-idee/srv/spa/catalog.search#/metadata/spaignPNOAMA">este</a></p>
<p><img alt="PNOA Máxima actualidad" src="../_images/maxima_actualidad.png" /></p>
<p>Para poder visualizar un servicio de este tipo en OpenLayers necesitaremos utilizar un tipo de capa que no habíamos utilizado hasta ahora, se trata del tipo <a href="https://openlayers.org/en/latest/apidoc/module-ol_layer_Image.html"><code>ol.layer.Image</code></a> con una fuente del tipo <a href="https://openlayers.org/en/latest/apidoc/module-ol_source_ImageWMS.html"><code>ol.source.ImageWMS</code></a>.</p>
<p>Según la documentación, habrá dos objetos que necesitamos para configurar la fuente de datos, la <code>url</code> y los <code>params</code> donde al menos <code>LAYERS</code> será obligatorio.</p>
<p>Explicaremos un poco de donde se sacan estos datos. Para configurar un servicio WMS la API de OpenLayers nos pide, una URL, la del servicio y unos parámetros que como mínimo serán el nombre de la capa que queremos cargar. Siguiendo la búsqueda que hemos realizado antes, podemos ver un botón que nos indica</p>
<p><img alt="Servicio WMS" src="../_images/boton_wms.png" /></p>
<p>Si pulsamos en ese botón, haremos una petición <code>GetCapabilities</code> del estandar WMS, que nos da la descripción del servicio en un hermoso XML</p>
<p><img alt="" src="../_images/200.gif" /></p>
<p>Tras el susto inicial, deberemos inspeccionar el documento para obtener los datos que necesitamos para configurar la capa. El primer dato será la URL del servicio, en este caso la obtendremos del navegador ya que es la misma donde estamos haciendo la petición <code>GetCapabilities</code></p>
<p><img alt="URL" src="../_images/url.png" /></p>
<p>eliminando los parámetros de la consulta, tendremos la URL del servicio, en este caso <code>http://www.ign.es/wms-inspire/pnoa-ma?</code></p>
<p>Para encontrar la capa que queremos utilizar, deberemos explorar el XML que nos devuelve. En este XML encontraremos una etiqueta de la forma</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">&lt;Layer</span> <span class="na">queryable=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
<span class="hll"><span class="nt">&lt;Name&gt;</span>OI.OrthoimageCoverage<span class="nt">&lt;/Name&gt;</span>
</span><span class="nt">&lt;Title&gt;</span>Ortoimagen<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;Abstract&gt;</span>
Cobertura ráster opaca de imágenes de satélite y ortofotos PNOA de máxima actualidad (MA). Rangos de visualización: Imagen Spot5 de 20 m de resolución hasta la escala aproximada 1:70 000; a partir de aquí ortofotografías PNOA MA de 0.25 m o 0.50 m de resolución, según la zona
<span class="nt">&lt;/Abstract&gt;</span>
<span class="nt">&lt;KeywordList&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>Ortofotografías<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>Ortofotos<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>PNOA<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;Keyword&gt;</span>España<span class="nt">&lt;/Keyword&gt;</span>
<span class="nt">&lt;/KeywordList&gt;</span>
<span class="nt">&lt;EX_GeographicBoundingBox&gt;</span>
<span class="nt">&lt;westBoundLongitude&gt;</span>-19.00<span class="nt">&lt;/westBoundLongitude&gt;</span>
<span class="nt">&lt;eastBoundLongitude&gt;</span>5.00<span class="nt">&lt;/eastBoundLongitude&gt;</span>
<span class="nt">&lt;southBoundLatitude&gt;</span>27.00<span class="nt">&lt;/southBoundLatitude&gt;</span>
<span class="nt">&lt;northBoundLatitude&gt;</span>44.00<span class="nt">&lt;/northBoundLatitude&gt;</span>
<span class="nt">&lt;/EX_GeographicBoundingBox&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;CRS:84&quot;</span> <span class="na">minx=</span><span class="s">&quot;-19.0&quot;</span> <span class="na">miny=</span><span class="s">&quot;27.0&quot;</span> <span class="na">maxx=</span><span class="s">&quot;5.0&quot;</span> <span class="na">maxy=</span><span class="s">&quot;44.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25830&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1099673.713793886&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.242554414&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1295248.9457834428&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4998012.359900884&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32630&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1099673.7137993197&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.2425578996&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1295248.9457861297&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4998012.359913771&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4258&quot;</span> <span class="na">minx=</span><span class="s">&quot;27.000000000763837&quot;</span> <span class="na">miny=</span><span class="s">&quot;-19.0&quot;</span> <span class="na">maxx=</span><span class="s">&quot;44.00000000094271&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4326&quot;</span> <span class="na">minx=</span><span class="s">&quot;27.0&quot;</span> <span class="na">miny=</span><span class="s">&quot;-19.0&quot;</span> <span class="na">maxx=</span><span class="s">&quot;44.0&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:4230&quot;</span> <span class="na">minx=</span><span class="s">&quot;36.17&quot;</span> <span class="na">miny=</span><span class="s">&quot;-9.52&quot;</span> <span class="na">maxx=</span><span class="s">&quot;44.00&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5.00&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25828&quot;</span> <span class="na">minx=</span><span class="s">&quot;102948.37120930111&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.242554414&quot;</span> <span class="na">maxx=</span><span class="s">&quot;2508202.7078586714&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5070480.910938781&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25829&quot;</span> <span class="na">minx=</span><span class="s">&quot;-495135.75545113813&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.138364256&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1897204.2192702503&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4968139.496965927&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:25831&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1714549.1480570585&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.138364256&quot;</span> <span class="na">maxx=</span><span class="s">&quot;698454.234216212&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5113259.329838102&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32628&quot;</span> <span class="na">minx=</span><span class="s">&quot;102948.37120796047&quot;</span> <span class="na">miny=</span><span class="s">&quot;2986435.2425578996&quot;</span> <span class="na">maxx=</span><span class="s">&quot;2508202.7078655367&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5070480.910951035&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32629&quot;</span> <span class="na">minx=</span><span class="s">&quot;-495135.75545450323&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.1383677055&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1897204.2192749865&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4968139.496979078&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:32631&quot;</span> <span class="na">minx=</span><span class="s">&quot;-1714549.148064664&quot;</span> <span class="na">miny=</span><span class="s">&quot;2988008.1383677055&quot;</span> <span class="na">maxx=</span><span class="s">&quot;698454.2342168819&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5113259.329849991&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:3857&quot;</span> <span class="na">minx=</span><span class="s">&quot;-2115070.325072198&quot;</span> <span class="na">miny=</span><span class="s">&quot;3123471.749104576&quot;</span> <span class="na">maxx=</span><span class="s">&quot;556597.4539663679&quot;</span> <span class="na">maxy=</span><span class="s">&quot;5465442.183322753&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:23029&quot;</span> <span class="na">minx=</span><span class="s">&quot;453232.16&quot;</span> <span class="na">miny=</span><span class="s">&quot;4002993.85&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1622799.23&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4968233.16&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:23030&quot;</span> <span class="na">minx=</span><span class="s">&quot;-86780.31&quot;</span> <span class="na">miny=</span><span class="s">&quot;4022622.27&quot;</span> <span class="na">maxx=</span><span class="s">&quot;1141492.98&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4903175.90&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;BoundingBox</span> <span class="na">CRS=</span><span class="s">&quot;EPSG:23031&quot;</span> <span class="na">minx=</span><span class="s">&quot;-628724.14&quot;</span> <span class="na">miny=</span><span class="s">&quot;4076330.91&quot;</span> <span class="na">maxx=</span><span class="s">&quot;660356.81&quot;</span> <span class="na">maxy=</span><span class="s">&quot;4873906.61&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;Attribution&gt;</span>
<span class="nt">&lt;Title&gt;</span>Sistema Cartográfico Nacional<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.scne.esm&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Attribution&gt;</span>
<span class="nt">&lt;Identifier</span> <span class="na">authority=</span><span class="s">&quot;SCNE&quot;</span><span class="nt">&gt;</span>OI.OrthoimageCoverage<span class="nt">&lt;/Identifier&gt;</span>
<span class="nt">&lt;MetadataURL</span> <span class="na">type=</span><span class="s">&quot;ISO19115:2003&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;Format&gt;</span>text/plain<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es/csw-inspire/srv/spa/csw?SERVICE=CSW&amp;VERSION=2.0.2&amp;REQUEST=GetRecordById&amp;outputSchema=http://www.isotc211.org/2005/gmd&amp;ElementSetName=full&amp;ID=spaignPNOAMA&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/MetadataURL&gt;</span>
<span class="nt">&lt;Style&gt;</span>
<span class="nt">&lt;Name&gt;</span>default<span class="nt">&lt;/Name&gt;</span>
<span class="nt">&lt;Title&gt;</span>Estilo por defecto de la ortoimagen<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;Abstract&gt;</span>
La cobertura de ortoimágenes se renderizan como datos raster
<span class="nt">&lt;/Abstract&gt;</span>
<span class="nt">&lt;LegendURL</span> <span class="na">width=</span><span class="s">&quot;125&quot;</span> <span class="na">height=</span><span class="s">&quot;21&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;Format&gt;</span>image/png<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;OnlineResource</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:href=</span><span class="s">&quot;http://www.ign.es/wms-inspire/pnoa-ma?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=OI.OrthoimageCoverage&amp;format=image/png&amp;STYLE=default&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/LegendURL&gt;</span>
<span class="nt">&lt;/Style&gt;</span>
<span class="nt">&lt;/Layer&gt;</span>
</pre></div>
</td></tr></table>

<p>Se trata de la descripción XML de una de las capas que nos ofrece el servicio. En este caso el valor que nos interesa para OpenLayers será el <code>Name</code></p>
<p>Y ya tendríamos los datos necesarios para configurar una capa WMS en nuestro visor.</p>
<p>Siguiendo la configuración que necesitamos mediante OpenLayers, deberemos crear una capa con el PNOA, para ello</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PNOA y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="hll">      <span class="kr">const</span> <span class="nx">PNOA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
</span><span class="hll">        <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageWMS</span><span class="p">({</span>
</span><span class="hll">          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wms-inspire/pnoa-ma?&#39;</span><span class="p">,</span>
</span><span class="hll">          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="s1">&#39;OI.OrthoimageCoverage&#39;</span><span class="p">},</span>
</span><span class="hll">        <span class="p">})</span>
</span><span class="hll">      <span class="p">})</span>
</span>      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.6832130</span><span class="p">,</span> <span class="mf">40.2589448</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">6</span>
        <span class="p">}),</span>
<span class="hll">      <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">        <span class="nx">PNOA</span>
</span><span class="hll">      <span class="p">]</span>
</span>      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p><img alt="URL" src="../_images/no_pnoa.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>¿Se ve el mapa?, probad a navegar sobre el mismo haciendo zoom y pan con el ratón, ¿lo encontráis?. ¿Sabeis que puede estar ocurriendo?.</p>
</div>
<p>Si inspeccionamos el mapa (Ctrl + Mayus + i en Chrome) y en la pestaña <em>Network</em>, veremos que se está realizando una petición al servicio del PNOA y que esta se está resolviendo correctamente.</p>
<p><img alt="Network" src="../_images/network.png" /></p>
<p>La petición que se está realizando es esta</p>
<p><a href="http://www.ign.es/wms-inspire/pnoa-ma?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;FORMAT=image%2Fpng&amp;TRANSPARENT=true&amp;LAYERS=OI.OrthoimageCoverage&amp;CRS=EPSG%3A3857&amp;STYLES=&amp;WIDTH=812&amp;HEIGHT=407&amp;BBOX=-993069.8714810099%2C-497757.9281930678%2C993069.8714810099%2C497757.9281930678">http://www.ign.es/wms-inspire/pnoa-ma?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;FORMAT=image/png&amp;TRANSPARENT=true&amp;LAYERS=OI.OrthoimageCoverage&amp;CRS=EPSG:3857&amp;STYLES=&amp;WIDTH=812&amp;HEIGHT=407&amp;BBOX=-993069.8714810099,-497757.9281930678,993069.8714810099,497757.9281930678</a></p>
<p>Que nos devuelve un fondo negro, sin embargo, si cambiamos alguno de estos datos, tendríamos una petición similar pero que si nos está devolviendo algo que podemos ver</p>
<p><a href="http://www.ign.es/wms-inspire/pnoa-ma?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;FORMAT=image%2Fpng&amp;TRANSPARENT=true&amp;LAYERS=OI.OrthoimageCoverage&amp;CRS=EPSG%3A3857&amp;STYLES=&amp;WIDTH=1170&amp;HEIGHT=585&amp;BBOX=-1841826.633559607%2C4188749.150027659%2C1019975.705437392%2C5619650.319526158">http://www.ign.es/wms-inspire/pnoa-ma?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;FORMAT=image/png&amp;TRANSPARENT=true&amp;LAYERS=OI.OrthoimageCoverage&amp;CRS=EPSG:3857&amp;STYLES=&amp;WIDTH=1170&amp;HEIGHT=585&amp;BBOX=-1841826.633559607,4188749.150027659,1019975.705437392,5619650.319526158</a></p>
<p>¿Cúal es la diferencia?. Si revisamos las URLs, veremos que están compuestas de parámetros por ejemplo, <code>REQUEST</code>, <code>FORMAT</code>, <code>LAYERS</code>, donde podemos ver algo que nos sonará, etc, todos definidos por el estandar, y encontraremos dos que son importantes para entender lo que está sucediendo, <code>CRS=EPSG:3827</code> y <code>BBOX=...</code>. </p>
<p><code>CRS</code> indica el sistema de coordenadas en el que se está realizando la petición, mientras que <code>BBOX</code> muestra las coordenadas del encuadre que se está visualizando. Si echamos un vistazo a las coordenadas. <code>-1841826.633559607,4188749.150027659,1019975.705437392,5619650.319526158</code>, veremos que se trata de unos números muy grandes, mientras que los que nosotros hemos usado para indicar el centro, son números mucho más pequeños, <code>-3.6832130, 40.2589448</code>. Esto en principio no resulta extraño si no se está acostumbrado a trabajar con coordenadas, pero lo que está pasando es que por defecto, OpenLayers utiliza las coordenadas <a href="https://en.wikipedia.org/wiki/Web_Mercator_projection"><em>Web Mercator</em> Wikipedia</a>, y ¿qué es la proyección <em>Web Mercator</em>?, pues es una proyección que se usa como estandar de facto en las aplicaciones web y es el que que están todos los servicios que hemos usado anteriormente. Sin embargo con las coordenadas que nosotros hemos indicado el centro están en el sistema <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS:84</a>, o lo que viene siendo coordenadas geográficas, las del GPS de toda la vida vamos.</p>
<p>Os dejamos un entretenido <a href="https://www.youtube.com/watch?v=kIID5FDi2JQ">video Youtube</a> explicando lo que son las proyecciones y los problemas que hay con su uso.</p>
<p>Pero volvamos a nuestro problema. Si como os decimos, el mapa de OpenLayers está por defecto en el sistema <em>Web Mercator</em>, una manera de solucionar nuestro problema de centrado, es transformar las coordenadas del centro a ese sistema. Para ello podremos utilizar cualquiera de los infinitos servicios web que existen para ello, por ejemplo <a href="http://epsg.io/transform#s_srs=4326&amp;t_srs=3857">epsg.io</a>. Si cambiamos las coordenadas a <code>Format: dm</code> e introducimos las coordenadas del centro, podremos obtener las mismas coordenadas transformadas. Si sustituimos esto en nuestro visor</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PNOA y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kr">const</span> <span class="nx">PNOA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
        <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageWMS</span><span class="p">({</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wms-inspire/pnoa-ma?&#39;</span><span class="p">,</span>
          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="s1">&#39;OI.OrthoimageCoverage&#39;</span><span class="p">},</span>
        <span class="p">})</span>
      <span class="p">})</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
<span class="hll">          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">410013.40</span><span class="p">,</span> <span class="mf">4903643.09</span><span class="p">],</span>
</span>          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">6</span>
        <span class="p">}),</span>
      <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">PNOA</span>
      <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>problema solucionado. Pero OpenLayers nos ofrece herramientas para poder realizar transformaciones usando la librería. Podríamos definir la proyección del mapa para que usase la que nosotros necesitamos, o podemos transformar las coordenadas usando las utilizades de proyección que tenemos disponibles. En este caso <a href="https://openlayers.org/en/latest/apidoc/module-ol_proj.html#.fromLonLat"><code>ol.proj.fromLonLat</code></a> nos permitirá transformar las coordenadas desde la proyección geográfica a cualquier sistema de coordenadas, por defecto <em>Web Mercator</em></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PNOA y OpenLayers<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://openlayers.org/en/v5.2.0/css/ol.css&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.2.0/build/ol.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="kr">const</span> <span class="nx">PNOA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Image</span><span class="p">({</span>
        <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">ImageWMS</span><span class="p">({</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.ign.es/wms-inspire/pnoa-ma?&#39;</span><span class="p">,</span>
          <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;LAYERS&#39;</span><span class="o">:</span> <span class="s1">&#39;OI.OrthoimageCoverage&#39;</span><span class="p">},</span>
        <span class="p">})</span>
      <span class="p">})</span>
      <span class="kd">let</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
<span class="hll">          <span class="nx">center</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">fromLonLat</span><span class="p">([</span><span class="o">-</span><span class="mf">3.6832130</span><span class="p">,</span> <span class="mf">40.2589448</span><span class="p">]),</span>
</span>          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">6</span>
        <span class="p">}),</span>
      <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">PNOA</span>
      <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p><a href="./../leaflet/2_capas_base">Probar con Leaflet</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../1_creando_mapa/" title="1. Creando un mapa" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                1. Creando un mapa
              </span>
            </div>
          </a>
        
        
          <a href="../3_mis_datos/" title="3. Mas allá de la capa base, añadiendo mis propios datos" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                3. Mas allá de la capa base, añadiendo mis propios datos
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>